<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Birthday Wish Creator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .text-input-section {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 30px;
            border-radius: 20px;
            color: white;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        }

        .text-input-section h2 {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .main-text-input {
            width: 100%;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            resize: vertical;
            min-height: 120px;
            font-family: Arial, sans-serif;
        }

        .main-text-input:focus {
            outline: none;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .main-text-input::placeholder {
            color: #999;
            font-style: italic;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .controls-collapsed {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 15px;
        }

        .control-group h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 1em;
        }

        .right-panel {
            display: flex;
            flex-direction: column;
        }

        .canvas-section {
            flex: 1;
        }

        .session-info {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }

        .session-info strong {
            display: block;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .timer {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 18px;
            margin-top: 5px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
            font-size: 14px;
        }

        input[type="text"], select, input[type="range"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        input[type="color"] {
            width: 50px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            cursor: pointer;
        }

        .color-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .gradient-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .preview-container {
            position: relative;
            margin-bottom: 30px;
        }

        .canvas-container {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        #mainCanvas {
            display: block;
            max-width: 100%;
            height: auto;
            border-radius: 15px;
        }

        .climate-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            border-radius: 15px;
        }

        .button-group {
            text-align: center;
            margin-top: 20px;
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .char-counter {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .range-value {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin-top: 5px;
        }

        .download-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .warning-message {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
            animation: gentleShake 0.5s ease-in-out;
            display: none;
        }

        .warning-message.show {
            display: block;
        }

        .warning-message h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .warning-message p {
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .close-warning {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .close-warning:hover {
            background: white;
            color: #ff6b6b;
        }

        @keyframes gentleShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-weight: bold;
            color: #666;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .particle {
            position: absolute;
            pointer-events: none;
        }

        .snowflake {
            color: white;
            font-size: 20px;
            animation: snowfall linear infinite;
        }

        .raindrop {
            width: 2px;
            height: 20px;
            background: rgba(173, 216, 230, 0.7);
            animation: rainfall linear infinite;
        }

        .heart {
            color: #ff69b4;
            font-size: 16px;
            animation: heartfall linear infinite;
        }

        .star {
            color: #ffd700;
            font-size: 14px;
            animation: starfall linear infinite;
        }

        @keyframes snowfall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes rainfall {
            0% {
                transform: translateY(-100vh);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh);
                opacity: 0;
            }
        }

        @keyframes heartfall {
            0% {
                transform: translateY(-100vh) scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: translateY(100vh) scale(0.8);
                opacity: 0;
            }
        }

        @keyframes starfall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-30px);
            }
            60% {
                transform: translateY(-15px);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }
            10%, 30%, 50%, 70%, 90% {
                transform: translateX(-10px);
            }
            20%, 40%, 60%, 80% {
                transform: translateX(10px);
            }
        }

        @keyframes glow {
            0% {
                filter: drop-shadow(0 0 5px currentColor);
            }
            50% {
                filter: drop-shadow(0 0 20px currentColor) drop-shadow(0 0 30px currentColor);
            }
            100% {
                filter: drop-shadow(0 0 5px currentColor);
            }
        }

        @keyframes rainbow {
            0% { color: #ff0000; }
            16% { color: #ff8000; }
            33% { color: #ffff00; }
            50% { color: #00ff00; }
            66% { color: #0080ff; }
            83% { color: #8000ff; }
            100% { color: #ff0000; }
        }

        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideIn {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(0);
            }
        }

        @media print {
            body {
                background: white !important;
            }
            .controls, .button-group, .tab-container {
                display: none !important;
            }
            .container {
                box-shadow: none !important;
                padding: 0 !important;
            }
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            .controls-collapsed {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .controls-collapsed {
                grid-template-columns: 1fr;
            }

            .text-input-section {
                padding: 20px;
            }

            .main-text-input {
                font-size: 16px;
                padding: 15px;
                min-height: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéâ Interactive Birthday Wish Creator üéÇ</h1>
            <p>Create personalized animated birthday wishes with photos, effects, and climate animations!</p>
        </div>

        <div class="warning-message" id="warningMessage">
            <h3>üåü Let's Keep It Positive! üåü</h3>
            <p>This app is designed to create beautiful, heartwarming birthday wishes that spread joy and happiness. Please use kind, positive words that would make someone smile on their special day.</p>
            <button class="close-warning" onclick="closeWarning()">I Understand</button>
        </div>

        <div class="main-layout">
            <div class="left-panel">
                <div class="text-input-section">
                    <h2>‚ú® Type Your Birthday Message</h2>
                    <textarea class="main-text-input" id="wishText" placeholder="Type your amazing birthday message here... üéâ&#10;&#10;Make someone's day special with your words!" maxlength="255"></textarea>
                    <div class="char-counter" style="text-align: center; margin-top: 15px; color: rgba(255,255,255,0.8);">
                        Characters: <span id="charCount">0</span>/255
                    </div>
                </div>

                <div class="tab-container">
                    <button class="tab active" onclick="switchTab('text')">üìù Animation</button>
                    <button class="tab" onclick="switchTab('media')">üñºÔ∏è Media</button>
                    <button class="tab" onclick="switchTab('climate')">üå¶Ô∏è Effects</button>
                </div>

                <div class="controls">
                    <div id="textTab" class="tab-content active">
                        <div class="controls-collapsed">
                            <div class="control-group">
                                <h3>‚ú® Animation</h3>
                                <div class="input-group">
                                    <label for="animation">Animation:</label>
                                    <select id="animation">
                                        <option value="none">No Animation</option>
                                        <option value="bounce">Bounce</option>
                                        <option value="pulse">Pulse</option>
                                        <option value="shake">Shake</option>
                                        <option value="glow">Glow</option>
                                        <option value="rainbow">Rainbow</option>
                                        <option value="rotate">Rotate</option>
                                        <option value="fadeIn">Fade In</option>
                                        <option value="slideIn">Slide In</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="fontSize">Font Size:</label>
                                    <input type="range" id="fontSize" min="20" max="120" value="60">
                                    <div class="range-value">Size: <span id="fontSizeValue">60</span>px</div>
                                </div>
                            </div>
                            <div class="control-group">
                                <h3>üé® Text Style</h3>
                                <div class="input-group">
                                    <label for="fontFamily">Font:</label>
                                    <select id="fontFamily">
                                        <option value="Arial, sans-serif">Arial</option>
                                        <option value="'Times New Roman', serif">Times New Roman</option>
                                        <option value="'Courier New', monospace">Courier New</option>
                                        <option value="'Comic Sans MS', cursive">Comic Sans MS</option>
                                        <option value="'Impact', fantasy">Impact</option>
                                        <option value="'Brush Script MT', cursive">Brush Script</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="textPosition">Position:</label>
                                    <select id="textPosition">
                                        <option value="center">Center</option>
                                        <option value="top">Top</option>
                                        <option value="bottom">Bottom</option>
                                        <option value="left">Left</option>
                                        <option value="right">Right</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="mediaTab" class="tab-content">
                        <div class="controls-collapsed">
                            <div class="control-group">
                                <h3>üñºÔ∏è Photo Upload</h3>
                                <div class="input-group">
                                    <label for="photoUpload">Background Photo:</label>
                                    <input type="file" id="photoUpload" accept="image/*">
                                </div>
                                <div class="input-group">
                                    <label for="photoOpacity">Photo Opacity:</label>
                                    <input type="range" id="photoOpacity" min="0" max="100" value="80">
                                    <div class="range-value">Opacity: <span id="photoOpacityValue">80</span>%</div>
                                </div>
                            </div>
                            <div class="control-group">
                                <h3>üé® Colors</h3>
                                <div class="input-group">
                                    <label for="textColor">Text Color:</label>
                                    <input type="color" id="textColor" value="#ffffff">
                                </div>
                                <div class="input-group">
                                    <label for="strokeColor">Text Stroke:</label>
                                    <input type="color" id="strokeColor" value="#000000">
                                </div>
                                <div class="input-group">
                                    <label for="strokeWidth">Stroke Width:</label>
                                    <input type="range" id="strokeWidth" min="0" max="10" value="2">
                                    <div class="range-value">Width: <span id="strokeWidthValue">2</span>px</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="climateTab" class="tab-content">
                        <div class="controls-collapsed">
                            <div class="control-group">
                                <h3>üå¶Ô∏è Climate Effects</h3>
                                <div class="input-group">
                                    <label for="climateEffect">Effect:</label>
                                    <select id="climateEffect">
                                        <option value="none">No Effect</option>
                                        <option value="snow">Snow ‚ùÑÔ∏è</option>
                                        <option value="rain">Rain üåßÔ∏è</option>
                                        <option value="hearts">Hearts üíï</option>
                                        <option value="stars">Stars ‚≠ê</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="particleIntensity">Intensity:</label>
                                    <input type="range" id="particleIntensity" min="1" max="10" value="5">
                                    <div class="range-value">Level: <span id="particleIntensityValue">5</span></div>
                                </div>
                            </div>
                            <div class="control-group">
                                <h3>üåà Background</h3>
                                <div class="input-group">
                                    <label for="backgroundType">Type:</label>
                                    <select id="backgroundType">
                                        <option value="solid">Solid Color</option>
                                        <option value="gradient">Gradient</option>
                                        <option value="photo">Photo Only</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="gradientColor1">Color 1:</label>
                                    <input type="color" id="gradientColor1" value="#667eea">
                                </div>
                                <div class="input-group">
                                    <label for="gradientColor2">Color 2:</label>
                                    <input type="color" id="gradientColor2" value="#764ba2">
                                </div>
                                <div class="input-group">
                                    <label for="gradientDirection">Direction:</label>
                                    <select id="gradientDirection">
                                        <option value="linear-gradient(135deg,">Diagonal</option>
                                        <option value="linear-gradient(90deg,">Horizontal</option>
                                        <option value="linear-gradient(0deg,">Vertical</option>
                                        <option value="radial-gradient(circle,">Radial</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <div class="session-info">
                    <strong>üéØ Your Personal Session</strong>
                    Session ID: <span id="sessionId">Loading...</span><br>
                    Time Remaining: <span class="timer" id="sessionTimer">12:00:00</span>
                </div>

                <div class="canvas-section">
                    <div class="canvas-container">
                        <canvas id="mainCanvas" width="800" height="600"></canvas>
                        <div class="climate-overlay" id="climateOverlay"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="button-group">
            <button onclick="randomizeColors()">üé≤ Random Colors</button>
            <button onclick="randomizeAnimation()">üé™ Random Animation</button>
            <button onclick="printWish()">üñ®Ô∏è Print Wish</button>
            <button onclick="resetAll()">üîÑ Reset All</button>
        </div>

        <div class="download-buttons">
            <button onclick="downloadImage('png')">üì• Download PNG</button>
            <button onclick="downloadImage('jpeg')">üì• Download JPG</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        let backgroundImage = null;
        let animationId = null;
        let particles = [];

        let userSession = {
            id: '',
            startTime: null,
            endTime: null,
            data: {}
        };

        const elements = {
            wishText: document.getElementById('wishText'),
            charCount: document.getElementById('charCount'),
            animation: document.getElementById('animation'),
            fontSize: document.getElementById('fontSize'),
            fontSizeValue: document.getElementById('fontSizeValue'),
            textColor: document.getElementById('textColor'),
            strokeColor: document.getElementById('strokeColor'),
            strokeWidth: document.getElementById('strokeWidth'),
            strokeWidthValue: document.getElementById('strokeWidthValue'),
            fontFamily: document.getElementById('fontFamily'),
            photoUpload: document.getElementById('photoUpload'),
            photoOpacity: document.getElementById('photoOpacity'),
            photoOpacityValue: document.getElementById('photoOpacityValue'),
            textPosition: document.getElementById('textPosition'),
            backgroundType: document.getElementById('backgroundType'),
            gradientColor1: document.getElementById('gradientColor1'),
            gradientColor2: document.getElementById('gradientColor2'),
            gradientDirection: document.getElementById('gradientDirection'),
            climateEffect: document.getElementById('climateEffect'),
            particleIntensity: document.getElementById('particleIntensity'),
            particleIntensityValue: document.getElementById('particleIntensityValue'),
            climateOverlay: document.getElementById('climateOverlay'),
            warningMessage: document.getElementById('warningMessage'),
            sessionId: document.getElementById('sessionId'),
            sessionTimer: document.getElementById('sessionTimer')
        };

        function generateSessionId() {
            return 'BWC-' + Math.random().toString(36).substring(2, 8).toUpperCase() +
                   '-' + Date.now().toString(36).toUpperCase();
        }

        function initializeSession() {
            const existingSession = localStorage.getItem('birthdayWishSession');
            const now = new Date().getTime();

            if (existingSession) {
                const session = JSON.parse(existingSession);
                const sessionAge = now - session.startTime;
                const twelveHours = 12 * 60 * 60 * 1000;

                if (sessionAge < twelveHours) {
                    userSession = session;
                    loadSessionData();
                } else {
                    createNewSession();
                }
            } else {
                createNewSession();
            }

            updateSessionDisplay();
            startSessionTimer();
        }

        function createNewSession() {
            const now = new Date().getTime();
            userSession = {
                id: generateSessionId(),
                startTime: now,
                endTime: now + (12 * 60 * 60 * 1000),
                data: {
                    wishText: '',
                    animation: 'none',
                    fontSize: 60,
                    textColor: '#ffffff',
                    strokeColor: '#000000',
                    strokeWidth: 2,
                    fontFamily: 'Arial, sans-serif',
                    textPosition: 'center',
                    backgroundType: 'gradient',
                    gradientColor1: '#667eea',
                    gradientColor2: '#764ba2',
                    gradientDirection: 'linear-gradient(135deg,',
                    climateEffect: 'none',
                    particleIntensity: 5,
                    photoOpacity: 80
                }
            };
            saveSession();
        }

        function saveSession() {
            userSession.data = {
                wishText: elements.wishText.value,
                animation: elements.animation.value,
                fontSize: elements.fontSize.value,
                textColor: elements.textColor.value,
                strokeColor: elements.strokeColor.value,
                strokeWidth: elements.strokeWidth.value,
                fontFamily: elements.fontFamily.value,
                textPosition: elements.textPosition.value,
                backgroundType: elements.backgroundType.value,
                gradientColor1: elements.gradientColor1.value,
                gradientColor2: elements.gradientColor2.value,
                gradientDirection: elements.gradientDirection.value,
                climateEffect: elements.climateEffect.value,
                particleIntensity: elements.particleIntensity.value,
                photoOpacity: elements.photoOpacity.value
            };
            localStorage.setItem('birthdayWishSession', JSON.stringify(userSession));
        }

        function loadSessionData() {
            const data = userSession.data;
            elements.wishText.value = data.wishText || '';
            elements.animation.value = data.animation || 'none';
            elements.fontSize.value = data.fontSize || 60;
            elements.textColor.value = data.textColor || '#ffffff';
            elements.strokeColor.value = data.strokeColor || '#000000';
            elements.strokeWidth.value = data.strokeWidth || 2;
            elements.fontFamily.value = data.fontFamily || 'Arial, sans-serif';
            elements.textPosition.value = data.textPosition || 'center';
            elements.backgroundType.value = data.backgroundType || 'gradient';
            elements.gradientColor1.value = data.gradientColor1 || '#667eea';
            elements.gradientColor2.value = data.gradientColor2 || '#764ba2';
            elements.gradientDirection.value = data.gradientDirection || 'linear-gradient(135deg,';
            elements.climateEffect.value = data.climateEffect || 'none';
            elements.particleIntensity.value = data.particleIntensity || 5;
            elements.photoOpacity.value = data.photoOpacity || 80;

            updateRangeValues();
            updateCharCount();
        }

        function updateSessionDisplay() {
            elements.sessionId.textContent = userSession.id;
        }

        function startSessionTimer() {
            setInterval(() => {
                const now = new Date().getTime();
                const timeLeft = userSession.endTime - now;

                if (timeLeft <= 0) {
                    resetSession();
                    return;
                }

                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                elements.sessionTimer.textContent =
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function resetSession() {
            localStorage.removeItem('birthdayWishSession');
            createNewSession();
            loadSessionData();
            updateSessionDisplay();
            updateCanvas();
            backgroundImage = null;
            elements.climateOverlay.innerHTML = '';
        }

        const profanityList = [
            'damn', 'hell', 'crap', 'stupid', 'idiot', 'moron', 'dumb', 'hate', 'suck', 'loser',
            'shut up', 'die', 'kill', 'death', 'murder', 'bloody', 'bastard', 'bitch', 'ass',
            'piss', 'shit', 'fuck', 'fucking', 'fucked', 'motherfucker', 'cocksucker',
            'dickhead', 'asshole', 'whore', 'slut', 'retard', 'gay', 'faggot', 'nigger',
            'chink', 'spic', 'kike', 'wetback', 'gook', 'raghead', 'towelhead', 'camel jockey'
        ];

        function containsProfanity(text) {
            const lowerText = text.toLowerCase();
            return profanityList.some(word => {
                const regex = new RegExp(`\\b${word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, 'i');
                return regex.test(lowerText);
            });
        }

        function showWarning() {
            elements.warningMessage.classList.add('show');
            setTimeout(() => {
                elements.warningMessage.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            }, 100);
        }

        function closeWarning() {
            elements.warningMessage.classList.remove('show');
        }

        function validateAndUpdateText() {
            const text = elements.wishText.value;

            if (containsProfanity(text)) {
                showWarning();
                elements.wishText.value = text.slice(0, -1);
                return false;
            }

            closeWarning();
            return true;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');

            const tabMap = {
                'text': 'textTab',
                'media': 'mediaTab',
                'climate': 'climateTab'
            };

            if (tabMap[tabName]) {
                document.getElementById(tabMap[tabName]).classList.add('active');
            }
        }

        function updateCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawBackground();
            drawBackgroundImage();
            drawText();
        }

        function drawBackground() {
            const bgType = elements.backgroundType.value;

            if (bgType === 'photo' && backgroundImage) {
                return;
            }

            if (bgType === 'gradient') {
                const direction = elements.gradientDirection.value;
                const color1 = elements.gradientColor1.value;
                const color2 = elements.gradientColor2.value;

                let gradient;
                if (direction.includes('radial')) {
                    gradient = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, Math.max(canvas.width, canvas.height)/2);
                } else if (direction.includes('90deg')) {
                    gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
                } else if (direction.includes('0deg')) {
                    gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                } else {
                    gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                }

                gradient.addColorStop(0, color1);
                gradient.addColorStop(1, color2);
                ctx.fillStyle = gradient;
            } else {
                ctx.fillStyle = elements.gradientColor1.value;
            }

            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function drawBackgroundImage() {
            if (backgroundImage) {
                const opacity = elements.photoOpacity.value / 100;
                ctx.globalAlpha = opacity;

                const aspectRatio = backgroundImage.width / backgroundImage.height;
                const canvasRatio = canvas.width / canvas.height;

                let drawWidth, drawHeight, offsetX, offsetY;

                if (aspectRatio > canvasRatio) {
                    drawHeight = canvas.height;
                    drawWidth = drawHeight * aspectRatio;
                    offsetX = (canvas.width - drawWidth) / 2;
                    offsetY = 0;
                } else {
                    drawWidth = canvas.width;
                    drawHeight = drawWidth / aspectRatio;
                    offsetX = 0;
                    offsetY = (canvas.height - drawHeight) / 2;
                }

                ctx.drawImage(backgroundImage, offsetX, offsetY, drawWidth, drawHeight);
                ctx.globalAlpha = 1;
            }
        }

        function drawText() {
            const text = elements.wishText.value || 'Happy Birthday! üéâ';
            const fontSize = elements.fontSize.value;
            const fontFamily = elements.fontFamily.value;
            const textColor = elements.textColor.value;
            const strokeColor = elements.strokeColor.value;
            const strokeWidth = elements.strokeWidth.value;
            const position = elements.textPosition.value;

            ctx.font = `bold ${fontSize}px ${fontFamily}`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            let x = canvas.width / 2;
            let y = canvas.height / 2;

            switch (position) {
                case 'top':
                    y = fontSize;
                    break;
                case 'bottom':
                    y = canvas.height - fontSize / 2;
                    break;
                case 'left':
                    x = fontSize;
                    ctx.textAlign = 'left';
                    break;
                case 'right':
                    x = canvas.width - fontSize;
                    ctx.textAlign = 'right';
                    break;
            }

            if (strokeWidth > 0) {
                ctx.strokeStyle = strokeColor;
                ctx.lineWidth = strokeWidth;
                ctx.strokeText(text, x, y);
            }

            ctx.fillStyle = textColor;
            ctx.fillText(text, x, y);
        }

        function createParticle(type) {
            const particle = {
                x: Math.random() * canvas.width,
                y: -20,
                speed: Math.random() * 3 + 1,
                size: Math.random() * 10 + 5,
                type: type
            };

            return particle;
        }

        function updateParticles() {
            const climateType = elements.climateEffect.value;
            const intensity = elements.particleIntensity.value;

            if (climateType === 'none') {
                elements.climateOverlay.innerHTML = '';
                return;
            }

            if (Math.random() < intensity / 20) {
                const particle = document.createElement('div');
                particle.className = `particle ${climateType === 'snow' ? 'snowflake' :
                                                climateType === 'rain' ? 'raindrop' :
                                                climateType === 'hearts' ? 'heart' : 'star'}`;

                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDuration = (Math.random() * 3 + 2) + 's';
                particle.style.animationDelay = Math.random() * 2 + 's';

                if (climateType === 'snow') {
                    particle.textContent = '‚ùÑ';
                } else if (climateType === 'hearts') {
                    particle.textContent = 'üíñ';
                } else if (climateType === 'stars') {
                    particle.textContent = '‚≠ê';
                }

                elements.climateOverlay.appendChild(particle);

                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 5000);
            }
        }

        function animate() {
            updateCanvas();
            updateParticles();
            animationId = requestAnimationFrame(animate);
        }

        function downloadImage(format) {
            const link = document.createElement('a');
            const filename = `birthday-wish.${format}`;

            if (format === 'jpeg') {
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;

                tempCtx.fillStyle = 'white';
                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                tempCtx.drawImage(canvas, 0, 0);

                link.href = tempCanvas.toDataURL('image/jpeg', 0.9);
            } else {
                link.href = canvas.toDataURL('image/png');
            }

            link.download = filename;
            link.click();
        }

        function randomizeColors() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7', '#fd79a8', '#00b894', '#fdcb6e', '#ff7675', '#74b9ff', '#a29bfe', '#fd79a8', '#e17055'];

            elements.textColor.value = colors[Math.floor(Math.random() * colors.length)];
            elements.gradientColor1.value = colors[Math.floor(Math.random() * colors.length)];
            elements.gradientColor2.value = colors[Math.floor(Math.random() * colors.length)];
            elements.strokeColor.value = colors[Math.floor(Math.random() * colors.length)];

            updateCanvas();
        }

        function randomizeAnimation() {
            const animations = ['bounce', 'pulse', 'shake', 'glow', 'rainbow', 'rotate', 'fadeIn', 'slideIn'];
            elements.animation.value = animations[Math.floor(Math.random() * animations.length)];
        }

        function printWish() {
            window.print();
        }

        function resetAll() {
            elements.wishText.value = '';
            elements.animation.value = 'none';
            elements.fontSize.value = 60;
            elements.textColor.value = '#ffffff';
            elements.strokeColor.value = '#000000';
            elements.strokeWidth.value = 2;
            elements.fontFamily.value = 'Arial, sans-serif';
            elements.textPosition.value = 'center';
            elements.backgroundType.value = 'gradient';
            elements.gradientColor1.value = '#667eea';
            elements.gradientColor2.value = '#764ba2';
            elements.gradientDirection.value = 'linear-gradient(135deg,';
            elements.climateEffect.value = 'none';
            elements.particleIntensity.value = 5;
            elements.photoOpacity.value = 80;

            backgroundImage = null;
            elements.climateOverlay.innerHTML = '';

            updateRangeValues();
            updateCharCount();
            updateCanvas();
        }

        function updateRangeValues() {
            elements.fontSizeValue.textContent = elements.fontSize.value;
            elements.strokeWidthValue.textContent = elements.strokeWidth.value;
            elements.photoOpacityValue.textContent = elements.photoOpacity.value;
            elements.particleIntensityValue.textContent = elements.particleIntensity.value;
        }

        function updateCharCount() {
            elements.charCount.textContent = elements.wishText.value.length;
        }

        elements.wishText.addEventListener('input', () => {
            if (validateAndUpdateText()) {
                updateCharCount();
                updateCanvas();
                saveSession();
            }
        });

        elements.photoUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        backgroundImage = img;
                        updateCanvas();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        [elements.fontSize, elements.strokeWidth, elements.photoOpacity, elements.particleIntensity].forEach(slider => {
            slider.addEventListener('input', () => {
                updateRangeValues();
                updateCanvas();
                saveSession();
            });
        });

        [elements.animation, elements.textColor, elements.strokeColor, elements.fontFamily,
         elements.textPosition, elements.backgroundType, elements.gradientColor1,
         elements.gradientColor2, elements.gradientDirection, elements.climateEffect].forEach(control => {
            control.addEventListener('change', () => {
                updateCanvas();
                saveSession();
            });
        });

        initializeSession();
        updateRangeValues();
        updateCharCount();
        updateCanvas();
        animate();
    </script>
</body>
</html>