<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Greeting Card Creator - Birthday Wishes</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .text-input-section {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 30px;
            border-radius: 20px;
            color: white;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        }

        .text-input-section h2 {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .main-text-input {
            width: 100%;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            resize: vertical;
            min-height: 120px;
            font-family: Arial, sans-serif;
        }

        .main-text-input:focus {
            outline: none;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .main-text-input::placeholder {
            color: #999;
            font-style: italic;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .controls-collapsed {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 15px;
        }

        .control-group h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 1em;
        }

        .right-panel {
            display: flex;
            flex-direction: column;
        }

        .canvas-section {
            flex: 1;
        }

        .session-info {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }

        .session-info strong {
            display: block;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .timer {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 18px;
            margin-top: 5px;
        }

        .greeting-info-section {
            background: linear-gradient(135deg, #e17055, #f39c12);
            padding: 25px;
            border-radius: 20px;
            color: white;
            margin-bottom: 20px;
            box-shadow: 0 15px 35px rgba(225, 112, 85, 0.3);
        }

        .greeting-info-section h2 {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.4em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .info-input {
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            transition: all 0.3s;
        }

        .info-input:focus {
            outline: none;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .greeting-templates {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            padding: 20px;
            border-radius: 15px;
            color: white;
            margin-bottom: 15px;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .template-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
        }

        .template-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .template-card.active {
            border-color: white;
            background: rgba(255, 255, 255, 0.2);
        }

        .template-emoji {
            font-size: 24px;
            display: block;
            margin-bottom: 8px;
        }

        .card-preview {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .card-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .card-header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .card-header p {
            opacity: 0.9;
        }

        .card-footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #eee;
        }

        .signature {
            font-style: italic;
            color: #666;
            margin-top: 10px;
        }

        .sharing-section {
            background: linear-gradient(135deg, #00b894, #00cec9);
            padding: 20px;
            border-radius: 15px;
            color: white;
            text-align: center;
            margin-top: 20px;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .share-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s;
            text-decoration: none;
        }

        .share-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .share-link {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 12px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
            cursor: pointer;
        }

        .share-link:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .session-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(46, 204, 113, 0.3);
            z-index: 1000;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 12px;
            min-width: 200px;
        }

        .session-toast.collapsed {
            transform: translateX(calc(100% - 40px));
        }

        .session-toast .toast-icon {
            font-size: 18px;
            margin-right: 10px;
        }

        .session-toast.collapsed .toast-content {
            display: none;
        }

        .session-toast.collapsed .toast-icon {
            margin: 0;
        }

        .toast-content {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .template-section-right {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            padding: 20px;
            border-radius: 15px;
            color: white;
            margin-bottom: 20px;
        }

        .template-section-right h3 {
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.1em;
        }

        .template-grid-compact {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .template-card-compact {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 10px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 10px;
        }

        .template-card-compact:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .template-card-compact.active {
            border-color: white;
            background: rgba(255, 255, 255, 0.2);
        }

        .template-emoji-compact {
            font-size: 18px;
            display: block;
            margin-bottom: 5px;
        }

        .top-section {
            background: white;
            border-radius: 0 0 20px 20px;
            padding: 25px 30px;
            margin: 0 -30px 30px -30px;
            border-bottom: 1px solid #eee;
        }

        .top-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        .intro-page {
            text-align: center;
            padding: 60px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            color: white;
            margin-bottom: 30px;
        }

        .intro-page h1 {
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .intro-page p {
            font-size: 1.2em;
            margin-bottom: 30px;
            opacity: 0.9;
            line-height: 1.6;
        }

        .mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .mode-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 30px 20px;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .mode-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .mode-card-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }

        .mode-card h3 {
            font-size: 1.4em;
            margin-bottom: 10px;
        }

        .mode-card p {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 0;
        }

        .app-content {
            display: none;
        }

        .app-content.active {
            display: block;
        }

        .intro-page.hidden {
            display: none;
        }

        .main-container {
            display: flex;
            min-height: 100vh;
        }

        .side-nav {
            width: 280px;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            z-index: 1000;
            overflow-y: auto;
        }

        .side-nav.collapsed {
            width: 60px;
        }

        .side-nav.collapsed .nav-text {
            display: none;
        }

        .side-nav.collapsed .nav-toggle {
            transform: rotate(180deg);
        }

        .nav-header {
            display: flex;
            flex-direction: column;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .nav-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .user-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .login-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .login-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .user-info {
            display: none;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 12px;
        }

        .user-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .logout-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 10px;
        }

        .nav-logo {
            font-size: 1.5em;
            font-weight: bold;
        }

        .nav-toggle {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-toggle:hover {
            background: rgba(255,255,255,0.2);
        }

        .nav-items {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.1);
        }

        .nav-link.active {
            background: rgba(255,255,255,0.2);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .nav-icon {
            width: 20px;
            text-align: center;
            margin-right: 15px;
            font-size: 1.1em;
        }

        .nav-text {
            transition: all 0.3s;
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            transition: all 0.3s ease;
            padding: 0;
        }

        .main-content.expanded {
            margin-left: 60px;
        }

        .container {
            max-width: none;
            margin: 0;
            padding: 20px;
        }

        .mode-selector {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .mode-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px 10px 0 0;
            border-bottom: 2px solid #eee;
            overflow: hidden;
            margin: 0 -30px;
            margin-bottom: 0;
        }

        .mode-tab {
            flex: 1;
            background: transparent;
            color: #666;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 14px;
            border-bottom: 3px solid transparent;
        }

        .mode-tab:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .mode-tab.active {
            background: white;
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .simple-mode .greeting-info-section,
        .simple-mode .greeting-templates,
        .simple-mode .card-preview {
            display: none !important;
        }

        .advanced-mode .right-panel .card-preview {
            display: block !important;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
            font-size: 14px;
        }

        input[type="text"], select, input[type="range"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        input[type="color"] {
            width: 50px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            cursor: pointer;
        }

        .color-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .gradient-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .preview-container {
            position: relative;
            margin-bottom: 30px;
        }

        .canvas-container {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        #mainCanvas {
            display: block;
            max-width: 100%;
            height: auto;
            border-radius: 15px;
        }

        .climate-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            border-radius: 15px;
        }

        .button-group {
            text-align: center;
            margin-top: 20px;
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .char-counter {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .range-value {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin-top: 5px;
        }

        .download-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .warning-message {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
            animation: gentleShake 0.5s ease-in-out;
            display: none;
        }

        .warning-message.show {
            display: block;
        }

        .warning-message h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .warning-message p {
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .close-warning {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .close-warning:hover {
            background: white;
            color: #ff6b6b;
        }

        @keyframes gentleShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-weight: bold;
            color: #666;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .particle {
            position: absolute;
            pointer-events: none;
        }

        .snowflake {
            color: white;
            font-size: 20px;
            animation: snowfall linear infinite;
        }

        .raindrop {
            width: 2px;
            height: 20px;
            background: rgba(173, 216, 230, 0.7);
            animation: rainfall linear infinite;
        }

        .heart {
            color: #ff69b4;
            font-size: 16px;
            animation: heartfall linear infinite;
        }

        .star {
            color: #ffd700;
            font-size: 14px;
            animation: starfall linear infinite;
        }

        @keyframes snowfall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes rainfall {
            0% {
                transform: translateY(-100vh);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh);
                opacity: 0;
            }
        }

        @keyframes heartfall {
            0% {
                transform: translateY(-100vh) scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: translateY(100vh) scale(0.8);
                opacity: 0;
            }
        }

        @keyframes starfall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-30px);
            }
            60% {
                transform: translateY(-15px);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }
            10%, 30%, 50%, 70%, 90% {
                transform: translateX(-10px);
            }
            20%, 40%, 60%, 80% {
                transform: translateX(10px);
            }
        }

        @keyframes glow {
            0% {
                filter: drop-shadow(0 0 5px currentColor);
            }
            50% {
                filter: drop-shadow(0 0 20px currentColor) drop-shadow(0 0 30px currentColor);
            }
            100% {
                filter: drop-shadow(0 0 5px currentColor);
            }
        }

        @keyframes rainbow {
            0% { color: #ff0000; }
            16% { color: #ff8000; }
            33% { color: #ffff00; }
            50% { color: #00ff00; }
            66% { color: #0080ff; }
            83% { color: #8000ff; }
            100% { color: #ff0000; }
        }

        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideIn {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(0);
            }
        }

        .rsvp-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .rsvp-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .rsvp-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .rsvp-item.declined {
            border-left-color: #dc3545;
        }

        .rsvp-item.maybe {
            border-left-color: #ffc107;
        }

        .rsvp-status {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            color: white;
        }

        .rsvp-status.accepted {
            background: #28a745;
        }

        .rsvp-status.declined {
            background: #dc3545;
        }

        .rsvp-status.maybe {
            background: #ffc107;
            color: #333;
        }

        .saved-evites {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .evite-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }

        .evite-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .evite-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .evite-date {
            font-size: 12px;
            color: #666;
        }

        .evite-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 12px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        @media print {
            body {
                background: white !important;
            }
            .controls, .button-group, .tab-container {
                display: none !important;
            }
            .container {
                box-shadow: none !important;
                padding: 0 !important;
            }
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            .controls-collapsed {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .controls-collapsed {
                grid-template-columns: 1fr;
            }

            .text-input-section {
                padding: 20px;
            }

            .main-text-input {
                font-size: 16px;
                padding: 15px;
                min-height: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <nav class="side-nav" id="sideNav">
            <div class="nav-header">
                <div class="nav-top">
                    <div class="nav-logo">
                        <span class="nav-text">üéâ Creator</span>
                    </div>
                    <button class="nav-toggle" onclick="toggleNav()">
                        <span>‚óÄ</span>
                    </button>
                </div>
                <div class="user-section">
                    <div id="g_id_onload"
                         data-client_id="132435517223-cgvv1befsebst3113v3nh9ie9hg9ur9u.apps.googleusercontent.com"
                         data-callback="handleCredentialResponse"
                         data-auto_prompt="false">
                    </div>
                    <div class="g_id_signin"
                         data-type="standard"
                         data-size="medium"
                         data-theme="outline"
                         data-text="sign_in_with"
                         data-shape="rectangular"
                         data-logo_alignment="left"
                         style="display: none;">
                    </div>
                    <button class="login-btn" id="loginBtn" onclick="showLogin()">
                        <span class="nav-text">üë§ Sign In</span>
                    </button>
                    <div class="user-info" id="userInfo">
                        <img class="user-avatar" id="userAvatar" src="" alt="User">
                        <span class="nav-text" id="userName">User</span>
                        <button class="logout-btn" onclick="logout()">
                            <span class="nav-text">Sign Out</span>
                        </button>
                    </div>
                </div>
            </div>

            <ul class="nav-items">
                <li class="nav-item">
                    <div class="nav-link active" onclick="showIntro()">
                        <span class="nav-icon">üè†</span>
                        <span class="nav-text">Home</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" onclick="startMode('simple')" data-mode="simple">
                        <span class="nav-icon">üé®</span>
                        <span class="nav-text">Simple Design</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" onclick="startMode('greeting')" data-mode="greeting">
                        <span class="nav-icon">üíå</span>
                        <span class="nav-text">E-Greeting</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" onclick="startMode('evite')" data-mode="evite">
                        <span class="nav-icon">üéä</span>
                        <span class="nav-text">E-vites</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" onclick="showSavedEvites()" id="savedEvitesNav" style="display: none;">
                        <span class="nav-icon">üíæ</span>
                        <span class="nav-text">My Evites</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" onclick="showRSVPDashboard()" id="rsvpDashboardNav" style="display: none;">
                        <span class="nav-icon">üìä</span>
                        <span class="nav-text">RSVP Dashboard</span>
                    </div>
                </li>
            </ul>
        </nav>

        <div class="main-content" id="mainContent">
            <div class="container">
                <div class="intro-page" id="introPage">
                    <h1>üéâ Birthday Creator Studio üéÇ</h1>
                    <p>Welcome to the ultimate birthday celebration toolkit! Create stunning wishes, beautiful e-greeting cards, or design exciting party invitations - all in one place.</p>

                    <div class="mode-cards">
                        <div class="mode-card" onclick="startMode('simple')">
                            <span class="mode-card-icon">üé®</span>
                            <h3>Simple Wish Design</h3>
                            <p>Quick & beautiful birthday wishes with animations and effects. Perfect for social media, printing, or instant sharing!</p>
                        </div>

                        <div class="mode-card" onclick="startMode('greeting')">
                            <span class="mode-card-icon">üíå</span>
                            <h3>E-Greeting Cards</h3>
                            <p>Professional greeting cards with personalized messages, templates, and full sharing capabilities across all platforms.</p>
                        </div>

                        <div class="mode-card" onclick="startMode('evite')">
                            <span class="mode-card-icon">üéä</span>
                            <h3>Birthday E-vites</h3>
                            <p>Create and send beautiful digital party invitations with RSVP tracking, event details, and celebration themes.</p>
                        </div>
                    </div>
                </div>

                <!-- Saved Evites Section -->
                <div class="saved-evites-page" id="savedEvitesPage" style="display: none;">
                    <div class="header">
                        <h1>üíæ My Saved E-vites</h1>
                        <p>Manage your created invitations and track RSVPs</p>
                    </div>

                    <div class="saved-evites" id="savedEvitesList">
                        <p>No saved e-vites yet. Create your first one!</p>
                    </div>
                </div>

                <!-- RSVP Dashboard Section -->
                <div class="rsvp-dashboard-page" id="rsvpDashboardPage" style="display: none;">
                    <div class="header">
                        <h1>üìä RSVP Dashboard</h1>
                        <p>Track responses for all your events</p>
                    </div>

                    <div class="rsvp-section" id="rsvpSection">
                        <h3>Recent RSVP Activity</h3>
                        <div class="rsvp-list" id="rsvpList">
                            <p>No RSVP activity yet.</p>
                        </div>
                    </div>
                </div>

                <div class="app-content" id="appContent">
            <div class="header">
                <h1 id="appTitle">üíå Birthday Wish Creator üéÇ</h1>
                <p id="appDescription">Create beautiful birthday wishes - choose your preferred style!</p>
            </div>

            <div class="mode-tabs">
                <button class="mode-tab active" id="simpleTab" onclick="switchMode('simple')">
                    üé® Simple Design
                </button>
                <button class="mode-tab" id="greetingTab" onclick="switchMode('greeting')">
                    üíå E-Greeting
                </button>
                <button class="mode-tab" id="eviteTab" onclick="switchMode('evite')">
                    üéä E-vite
                </button>
                <button class="mode-tab" style="margin-left: auto; background: rgba(255,255,255,0.1);" onclick="showIntro()">
                    üè† Home
                </button>
            </div>

            <div class="top-section" id="topSection">
                <div class="top-row" id="advancedRow" style="display: none;">
                    <div class="greeting-info-section">
                        <h2 id="detailsTitle">üìù Greeting Card Details</h2>
                        <div class="info-grid">
                            <input type="text" id="recipientName" class="info-input" placeholder="Recipient's Name" maxlength="50">
                            <input type="text" id="senderName" class="info-input" placeholder="Your Name" maxlength="50">
                            <input type="text" id="occasion" class="info-input" placeholder="Occasion (e.g., 25th Birthday)" maxlength="50">
                            <input type="date" id="eventDate" class="info-input">
                            <div class="photo-upload-section" id="evitePhotoSection" style="display: none;">
                                <label for="evitePhoto">Party Photo:</label>
                                <input type="file" id="evitePhoto" class="info-input" accept="image/*" style="padding: 8px;">
                            </div>
                        </div>
                    </div>

                    <div class="greeting-templates">
                        <h3 style="margin-bottom: 10px; text-align: center;" id="templateTitle">üé® Choose Template</h3>
                        <div class="template-grid" id="templateGrid">
                            <div class="template-card active" data-template="classic">
                                <span class="template-emoji">üéÇ</span>
                                Classic
                            </div>
                            <div class="template-card" data-template="party">
                                <span class="template-emoji">üéâ</span>
                                Party
                            </div>
                            <div class="template-card" data-template="elegant">
                                <span class="template-emoji">‚ú®</span>
                                Elegant
                            </div>
                            <div class="template-card" data-template="fun">
                                <span class="template-emoji">üéà</span>
                                Fun
                            </div>
                            <div class="template-card" data-template="love">
                                <span class="template-emoji">üíñ</span>
                                Love
                            </div>
                            <div class="template-card" data-template="cute">
                                <span class="template-emoji">ü•≥</span>
                                Cute
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        <div class="warning-message" id="warningMessage">
            <h3>üåü Let's Keep It Positive! üåü</h3>
            <p>This app is designed to create beautiful, heartwarming birthday wishes that spread joy and happiness. Please use kind, positive words that would make someone smile on their special day.</p>
            <button class="close-warning" onclick="closeWarning()">I Understand</button>
        </div>

        <div class="main-layout">
            <div class="left-panel">
                <div class="text-input-section">
                    <h2>‚ú® Your Personal Message</h2>
                    <textarea class="main-text-input" id="wishText" placeholder="Write your heartfelt birthday message here... üéâ&#10;&#10;Make this birthday extra special with your words!" maxlength="255"></textarea>
                    <div class="char-counter" style="text-align: center; margin-top: 15px; color: rgba(255,255,255,0.8);">
                        Characters: <span id="charCount">0</span>/255
                    </div>
                </div>

                <div class="tab-container">
                    <button class="tab active" onclick="switchTab('text')">üìù Animation</button>
                    <button class="tab" onclick="switchTab('media')">üñºÔ∏è Media</button>
                    <button class="tab" onclick="switchTab('climate')">üå¶Ô∏è Effects</button>
                </div>

                <div class="controls">
                    <div id="textTab" class="tab-content active">
                        <div class="controls-collapsed">
                            <div class="control-group">
                                <h3>‚ú® Animation</h3>
                                <div class="input-group">
                                    <label for="animation">Animation:</label>
                                    <select id="animation">
                                        <option value="none">No Animation</option>
                                        <option value="bounce">Bounce</option>
                                        <option value="pulse">Pulse</option>
                                        <option value="shake">Shake</option>
                                        <option value="glow">Glow</option>
                                        <option value="rainbow">Rainbow</option>
                                        <option value="rotate">Rotate</option>
                                        <option value="fadeIn">Fade In</option>
                                        <option value="slideIn">Slide In</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="fontSize">Font Size:</label>
                                    <input type="range" id="fontSize" min="20" max="120" value="60">
                                    <div class="range-value">Size: <span id="fontSizeValue">60</span>px</div>
                                </div>
                            </div>
                            <div class="control-group">
                                <h3>üé® Text Style</h3>
                                <div class="input-group">
                                    <label for="fontFamily">Font:</label>
                                    <select id="fontFamily">
                                        <option value="Arial, sans-serif">Arial</option>
                                        <option value="'Times New Roman', serif">Times New Roman</option>
                                        <option value="'Courier New', monospace">Courier New</option>
                                        <option value="'Comic Sans MS', cursive">Comic Sans MS</option>
                                        <option value="'Impact', fantasy">Impact</option>
                                        <option value="'Brush Script MT', cursive">Brush Script</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="textPosition">Position:</label>
                                    <select id="textPosition">
                                        <option value="center">Center</option>
                                        <option value="top">Top</option>
                                        <option value="bottom">Bottom</option>
                                        <option value="left">Left</option>
                                        <option value="right">Right</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="mediaTab" class="tab-content">
                        <div class="controls-collapsed">
                            <div class="control-group">
                                <h3>üñºÔ∏è Photo Upload</h3>
                                <div class="input-group">
                                    <label for="photoUpload">Background Photo:</label>
                                    <input type="file" id="photoUpload" accept="image/*">
                                </div>
                                <div class="input-group">
                                    <label for="photoOpacity">Photo Opacity:</label>
                                    <input type="range" id="photoOpacity" min="0" max="100" value="80">
                                    <div class="range-value">Opacity: <span id="photoOpacityValue">80</span>%</div>
                                </div>
                            </div>
                            <div class="control-group">
                                <h3>üé® Colors</h3>
                                <div class="input-group">
                                    <label for="textColor">Text Color:</label>
                                    <input type="color" id="textColor" value="#ffffff">
                                </div>
                                <div class="input-group">
                                    <label for="strokeColor">Text Stroke:</label>
                                    <input type="color" id="strokeColor" value="#000000">
                                </div>
                                <div class="input-group">
                                    <label for="strokeWidth">Stroke Width:</label>
                                    <input type="range" id="strokeWidth" min="0" max="10" value="2">
                                    <div class="range-value">Width: <span id="strokeWidthValue">2</span>px</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="climateTab" class="tab-content">
                        <div class="controls-collapsed">
                            <div class="control-group">
                                <h3>üå¶Ô∏è Climate Effects</h3>
                                <div class="input-group">
                                    <label for="climateEffect">Effect:</label>
                                    <select id="climateEffect">
                                        <option value="none">No Effect</option>
                                        <option value="snow">Snow ‚ùÑÔ∏è</option>
                                        <option value="rain">Rain üåßÔ∏è</option>
                                        <option value="hearts">Hearts üíï</option>
                                        <option value="stars">Stars ‚≠ê</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="particleIntensity">Intensity:</label>
                                    <input type="range" id="particleIntensity" min="1" max="10" value="5">
                                    <div class="range-value">Level: <span id="particleIntensityValue">5</span></div>
                                </div>
                            </div>
                            <div class="control-group">
                                <h3>üåà Background</h3>
                                <div class="input-group">
                                    <label for="backgroundType">Type:</label>
                                    <select id="backgroundType">
                                        <option value="solid">Solid Color</option>
                                        <option value="gradient">Gradient</option>
                                        <option value="photo">Photo Only</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="gradientColor1">Color 1:</label>
                                    <input type="color" id="gradientColor1" value="#667eea">
                                </div>
                                <div class="input-group">
                                    <label for="gradientColor2">Color 2:</label>
                                    <input type="color" id="gradientColor2" value="#764ba2">
                                </div>
                                <div class="input-group">
                                    <label for="gradientDirection">Direction:</label>
                                    <select id="gradientDirection">
                                        <option value="linear-gradient(135deg,">Diagonal</option>
                                        <option value="linear-gradient(90deg,">Horizontal</option>
                                        <option value="linear-gradient(0deg,">Vertical</option>
                                        <option value="radial-gradient(circle,">Radial</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-panel">

                <div class="card-preview" id="cardPreview" style="display: none;">
                    <div class="card-header" id="cardHeader">
                        <h1 id="cardTitle">üéâ Happy Birthday! üéÇ</h1>
                        <p id="cardSubtitle">Hope your special day is wonderful!</p>
                    </div>
                    <div class="canvas-section">
                        <div class="canvas-container">
                            <canvas id="mainCanvas" width="800" height="600"></canvas>
                            <div class="climate-overlay" id="climateOverlay"></div>
                        </div>
                    </div>
                    <div class="card-footer" id="cardFooter">
                        <div style="color: #333; font-weight: bold;" id="footerMessage">
                            Wishing you joy and happiness on your special day! üéà
                        </div>
                        <div class="signature" id="cardSignature">
                            With love, <span id="senderDisplay">Someone Special</span> ‚ù§Ô∏è
                        </div>
                    </div>
                </div>

                <div class="canvas-section" id="simpleCanvas">
                    <div class="canvas-container">
                        <canvas id="simpleMainCanvas" width="800" height="600"></canvas>
                        <div class="climate-overlay" id="simpleClimateOverlay"></div>
                    </div>
                </div>

                <div class="sharing-section" id="sharingSection" style="display: none;">
                    <h3>üì§ Share Your E-Greeting</h3>
                    <p>Share this beautiful card with your loved one!</p>
                    <div class="share-link" id="shareableLink" onclick="copyToClipboard()">
                        Click to generate shareable link
                    </div>
                    <div class="share-buttons">
                        <button class="share-btn" onclick="shareViaEmail()">üìß Email</button>
                        <button class="share-btn" onclick="shareViaWhatsApp()">üì± WhatsApp</button>
                        <button class="share-btn" onclick="shareViaFacebook()">üìò Facebook</button>
                        <button class="share-btn" onclick="shareViaTwitter()">üê¶ Twitter</button>
                        <button class="share-btn" onclick="downloadFullCard()">üíæ Download Card</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="button-group">
            <button onclick="randomizeColors()">üé≤ Random Colors</button>
            <button onclick="randomizeAnimation()">üé™ Random Animation</button>
            <button onclick="printWish()">üñ®Ô∏è Print Wish</button>
            <button onclick="resetAll()">üîÑ Reset All</button>
        </div>

        <div class="download-buttons">
            <button onclick="downloadImage('png')">üì• Download PNG</button>
            <button onclick="downloadImage('jpeg')">üì• Download JPG</button>
            <button onclick="saveEvite()" id="saveEviteBtn" style="display: none;">üíæ Save E-vite</button>
            <button onclick="shareEvite()" id="shareEviteBtn" style="display: none;">üì§ Share E-vite</button>
        </div>

        <div class="session-toast" id="sessionToast" onclick="toggleSessionToast()">
            <div class="toast-icon">‚è±Ô∏è</div>
            <div class="toast-content">
                <div><strong>Session:</strong> <span id="sessionIdToast">Loading...</span></div>
                <div><strong>Time:</strong> <span id="sessionTimerToast">12:00:00</span></div>
                </div>
            </div>
        </div>

        <div class="session-toast" id="sessionToast" onclick="toggleSessionToast()">
            <div class="toast-icon">‚è±Ô∏è</div>
            <div class="toast-content">
                <div><strong>Session:</strong> <span id="sessionIdToast">Loading...</span></div>
                <div><strong>Time:</strong> <span id="sessionTimerToast">12:00:00</span></div>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'simple';
        let currentTemplate = 'classic';
        let currentUser = null;
        let savedEvites = [];

        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const simpleCanvas = document.getElementById('simpleMainCanvas');
        const simpleCtx = simpleCanvas.getContext('2d');

        let backgroundImage = null;
        let animationId = null;
        let particles = [];

        const templates = {
            greeting: {
                classic: {
                    title: 'üéâ Happy Birthday! üéÇ',
                    subtitle: 'Hope your special day is wonderful!',
                    footer: 'Wishing you joy and happiness on your special day! üéà',
                    colors: { primary: '#667eea', secondary: '#764ba2' },
                    defaultAnimation: 'bounce'
                },
                party: {
                    title: 'üéä Let\'s Party! ü•≥',
                    subtitle: 'It\'s time to celebrate YOU!',
                    footer: 'Hope your birthday is as awesome as you are! üéâ',
                    colors: { primary: '#ff6b6b', secondary: '#ffa726' },
                    defaultAnimation: 'shake'
                },
                elegant: {
                    title: '‚ú® Happy Birthday ‚ú®',
                    subtitle: 'May this year bring you endless joy',
                    footer: 'With warmest wishes on your special day üåü',
                    colors: { primary: '#a29bfe', secondary: '#6c5ce7' },
                    defaultAnimation: 'glow'
                },
                fun: {
                    title: 'üéà Birthday Fun! üéà',
                    subtitle: 'Another year of amazing adventures!',
                    footer: 'Keep being awesome and have a blast! üöÄ',
                    colors: { primary: '#00cec9', secondary: '#00b894' },
                    defaultAnimation: 'pulse'
                },
                love: {
                    title: 'üíñ Happy Birthday Darling! üíñ',
                    subtitle: 'You mean the world to me',
                    footer: 'Sending you all my love on your birthday! üíï',
                    colors: { primary: '#fd79a8', secondary: '#e84393' },
                    defaultAnimation: 'rainbow'
                },
                cute: {
                    title: 'ü•≥ Cutie\'s Birthday! üßÅ',
                    subtitle: 'You\'re simply adorable!',
                    footer: 'Hope your day is as sweet as cake! üç∞',
                    colors: { primary: '#fdcb6e', secondary: '#e17055' },
                    defaultAnimation: 'rotate'
                }
            },
            evite: {
                classic: {
                    title: 'üéä You\'re Invited! üéâ',
                    subtitle: 'Join us for a Birthday Celebration!',
                    footer: 'Can\'t wait to celebrate with you! Please RSVP üìû',
                    colors: { primary: '#667eea', secondary: '#764ba2' },
                    defaultAnimation: 'bounce'
                },
                party: {
                    title: 'ü•≥ Party Time! üéà',
                    subtitle: 'Let\'s celebrate in style!',
                    footer: 'Come ready to party and have fun! RSVP required üé™',
                    colors: { primary: '#ff6b6b', secondary: '#ffa726' },
                    defaultAnimation: 'shake'
                },
                elegant: {
                    title: '‚ú® Birthday Soir√©e ‚ú®',
                    subtitle: 'You\'re cordially invited to celebrate',
                    footer: 'The pleasure of your company is requested üåü',
                    colors: { primary: '#a29bfe', secondary: '#6c5ce7' },
                    defaultAnimation: 'glow'
                },
                fun: {
                    title: 'üé™ Birthday Bash! üé†',
                    subtitle: 'Come celebrate with games and fun!',
                    footer: 'Bring your party spirit and get ready for fun! üéØ',
                    colors: { primary: '#00cec9', secondary: '#00b894' },
                    defaultAnimation: 'pulse'
                },
                love: {
                    title: 'üíù Intimate Birthday Gathering üíï',
                    subtitle: 'Celebrate with family and close friends',
                    footer: 'Your presence would make this day extra special ‚ù§Ô∏è',
                    colors: { primary: '#fd79a8', secondary: '#e84393' },
                    defaultAnimation: 'rainbow'
                },
                cute: {
                    title: 'üßÅ Sweet Birthday Party üç∞',
                    subtitle: 'Join us for cake, games, and giggles!',
                    footer: 'Come hungry for cake and fun! See you there! üéà',
                    colors: { primary: '#fdcb6e', secondary: '#e17055' },
                    defaultAnimation: 'rotate'
                }
            }
        };

        let userSession = {
            id: '',
            startTime: null,
            endTime: null,
            data: {}
        };

        const elements = {
            wishText: document.getElementById('wishText'),
            charCount: document.getElementById('charCount'),
            animation: document.getElementById('animation'),
            fontSize: document.getElementById('fontSize'),
            fontSizeValue: document.getElementById('fontSizeValue'),
            textColor: document.getElementById('textColor'),
            strokeColor: document.getElementById('strokeColor'),
            strokeWidth: document.getElementById('strokeWidth'),
            strokeWidthValue: document.getElementById('strokeWidthValue'),
            fontFamily: document.getElementById('fontFamily'),
            photoUpload: document.getElementById('photoUpload'),
            photoOpacity: document.getElementById('photoOpacity'),
            photoOpacityValue: document.getElementById('photoOpacityValue'),
            textPosition: document.getElementById('textPosition'),
            backgroundType: document.getElementById('backgroundType'),
            gradientColor1: document.getElementById('gradientColor1'),
            gradientColor2: document.getElementById('gradientColor2'),
            gradientDirection: document.getElementById('gradientDirection'),
            climateEffect: document.getElementById('climateEffect'),
            particleIntensity: document.getElementById('particleIntensity'),
            particleIntensityValue: document.getElementById('particleIntensityValue'),
            climateOverlay: document.getElementById('climateOverlay'),
            warningMessage: document.getElementById('warningMessage'),
            sessionId: document.getElementById('sessionId'),
            sessionTimer: document.getElementById('sessionTimer'),
            sessionIdToast: document.getElementById('sessionIdToast'),
            sessionTimerToast: document.getElementById('sessionTimerToast'),
            sessionToast: document.getElementById('sessionToast'),
            recipientName: document.getElementById('recipientName'),
            senderName: document.getElementById('senderName'),
            occasion: document.getElementById('occasion'),
            eventDate: document.getElementById('eventDate'),
            evitePhoto: document.getElementById('evitePhoto'),
            evitePhotoSection: document.getElementById('evitePhotoSection'),
            cardPreview: document.getElementById('cardPreview'),
            cardTitle: document.getElementById('cardTitle'),
            cardSubtitle: document.getElementById('cardSubtitle'),
            footerMessage: document.getElementById('footerMessage'),
            senderDisplay: document.getElementById('senderDisplay'),
            simpleCanvas: document.getElementById('simpleCanvas'),
            sharingSection: document.getElementById('sharingSection'),
            shareableLink: document.getElementById('shareableLink'),
            templateGrid: document.getElementById('templateGrid'),
            advancedRow: document.getElementById('advancedRow'),
            introPage: document.getElementById('introPage'),
            appContent: document.getElementById('appContent'),
            appTitle: document.getElementById('appTitle'),
            appDescription: document.getElementById('appDescription'),
            detailsTitle: document.getElementById('detailsTitle'),
            templateTitle: document.getElementById('templateTitle'),
            sideNav: document.getElementById('sideNav'),
            mainContent: document.getElementById('mainContent')
        };

        let isToastCollapsed = false;
        let isNavCollapsed = false;

        function toggleNav() {
            isNavCollapsed = !isNavCollapsed;
            elements.sideNav.classList.toggle('collapsed', isNavCollapsed);
            elements.mainContent.classList.toggle('expanded', isNavCollapsed);
        }

        function toggleSessionToast() {
            isToastCollapsed = !isToastCollapsed;
            elements.sessionToast.classList.toggle('collapsed', isToastCollapsed);
        }

        function updateNavActiveState() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            if (currentMode) {
                const activeLink = document.querySelector(`[data-mode="${currentMode}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
            } else {
                // Home is active
                document.querySelector('.nav-link[onclick="showIntro()"]').classList.add('active');
            }
        }

        function showIntro() {
            hideAllPages();
            elements.introPage.style.display = 'block';
            currentMode = null;
            updateNavActiveState();
        }

        function startMode(mode) {
            hideAllPages();
            elements.appContent.style.display = 'block';
            switchMode(mode);
            updateNavActiveState();
        }

        function switchMode(mode) {
            currentMode = mode;
            document.body.className = mode + '-mode';

            // Update tab states
            document.getElementById('simpleTab').classList.toggle('active', mode === 'simple');
            document.getElementById('greetingTab').classList.toggle('active', mode === 'greeting');
            document.getElementById('eviteTab').classList.toggle('active', mode === 'evite');

            // Update titles and placeholders based on mode
            if (mode === 'simple') {
                elements.appTitle.textContent = 'üé® Simple Birthday Wishes';
                elements.appDescription.textContent = 'Create quick, beautiful birthday wishes with animations and effects!';
                elements.advancedRow.style.display = 'none';
                elements.simpleCanvas.style.display = 'block';
                elements.cardPreview.style.display = 'none';
                elements.sharingSection.style.display = 'none';
            } else if (mode === 'greeting') {
                elements.appTitle.textContent = 'üíå E-Greeting Cards';
                elements.appDescription.textContent = 'Design professional greeting cards with personalized messages and templates!';
                elements.detailsTitle.textContent = 'üìù Greeting Card Details';
                elements.templateTitle.textContent = 'üé® Choose Greeting Template';
                elements.advancedRow.style.display = 'block';
                elements.simpleCanvas.style.display = 'none';
                elements.cardPreview.style.display = 'block';
                elements.sharingSection.style.display = 'block';
                updateCardPreview();
            } else if (mode === 'evite') {
                elements.appTitle.textContent = 'üéä Birthday E-vites';
                elements.appDescription.textContent = 'Create stunning digital party invitations with RSVP and event details!';
                elements.detailsTitle.textContent = 'üéâ Party Invitation Details';
                elements.templateTitle.textContent = 'üé™ Choose Invitation Template';
                elements.recipientName.placeholder = 'Guest\'s Name';
                elements.senderName.placeholder = 'Host Name';
                elements.occasion.placeholder = 'Event (e.g., Sarah\'s 30th Birthday Party)';
                elements.evitePhotoSection.style.display = 'block';
                elements.advancedRow.style.display = 'block';
                elements.simpleCanvas.style.display = 'none';
                elements.cardPreview.style.display = 'block';
                elements.sharingSection.style.display = 'block';

                // Show save/share buttons if user is logged in
                if (currentUser) {
                    document.getElementById('saveEviteBtn').style.display = 'inline-block';
                    document.getElementById('shareEviteBtn').style.display = 'inline-block';
                }
                updateCardPreview();
            }

            // Hide photo section for non-evite modes
            if (mode !== 'evite') {
                elements.evitePhotoSection.style.display = 'none';
            }

            saveSession();
        }

        function selectTemplate(templateName) {
            currentTemplate = templateName;

            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelectorAll(`[data-template="${templateName}"]`).forEach(card => {
                card.classList.add('active');
            });

            const templateType = (currentMode === 'simple') ? 'greeting' : currentMode;
            const template = templates[templateType][templateName];

            if (template) {
                elements.gradientColor1.value = template.colors.primary;
                elements.gradientColor2.value = template.colors.secondary;
                elements.animation.value = template.defaultAnimation;
            }

            updateCardPreview();
            updateCanvas();
            saveSession();
        }

        // Authentication Functions
        function handleCredentialResponse(response) {
            const responsePayload = decodeJwtResponse(response.credential);

            currentUser = {
                id: responsePayload.sub,
                name: responsePayload.name,
                email: responsePayload.email,
                picture: responsePayload.picture
            };

            showUserLoggedIn();
            loadUserData();
        }

        function decodeJwtResponse(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        function showLogin() {
            document.querySelector('.g_id_signin').style.display = 'block';
        }

        function showUserLoggedIn() {
            document.getElementById('loginBtn').style.display = 'none';
            document.querySelector('.g_id_signin').style.display = 'none';
            document.getElementById('userInfo').style.display = 'flex';
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userAvatar').src = currentUser.picture;

            // Show user-specific navigation items
            document.getElementById('savedEvitesNav').style.display = 'block';
            document.getElementById('rsvpDashboardNav').style.display = 'block';

            // Show save/share buttons in evite mode
            if (currentMode === 'evite') {
                document.getElementById('saveEviteBtn').style.display = 'inline-block';
                document.getElementById('shareEviteBtn').style.display = 'inline-block';
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginBtn').style.display = 'block';
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('savedEvitesNav').style.display = 'none';
            document.getElementById('rsvpDashboardNav').style.display = 'none';
            document.getElementById('saveEviteBtn').style.display = 'none';
            document.getElementById('shareEviteBtn').style.display = 'none';

            // Clear user data
            savedEvites = [];
            showIntro();
        }

        // RSVP and Evite Management Functions
        function saveEvite() {
            if (!currentUser) {
                alert('Please sign in to save your e-vite');
                return;
            }

            const eviteData = {
                id: Date.now(),
                userId: currentUser.id,
                title: elements.occasion.value || 'Birthday Party',
                recipientName: elements.recipientName.value,
                senderName: elements.senderName.value,
                message: elements.wishText.value,
                date: new Date().toLocaleDateString(),
                template: currentTemplate,
                rsvps: []
            };

            savedEvites.push(eviteData);
            saveUserData();
            alert('E-vite saved successfully!');
        }

        function shareEvite() {
            if (!currentUser) {
                alert('Please sign in to share your e-vite');
                return;
            }

            const shareUrl = generateShareableLink();
            if (navigator.share) {
                navigator.share({
                    title: 'Birthday Party Invitation',
                    text: `You're invited to ${elements.occasion.value || 'a birthday party'}!`,
                    url: shareUrl
                });
            } else {
                navigator.clipboard.writeText(shareUrl);
                alert('Share link copied to clipboard!');
            }
        }

        function generateShareableLink() {
            const eviteData = encodeURIComponent(JSON.stringify({
                occasion: elements.occasion.value,
                recipientName: elements.recipientName.value,
                senderName: elements.senderName.value,
                message: elements.wishText.value,
                template: currentTemplate
            }));
            return `${window.location.origin}${window.location.pathname}?rsvp=${eviteData}`;
        }

        function showSavedEvites() {
            hideAllPages();
            document.getElementById('savedEvitesPage').style.display = 'block';
            loadSavedEvites();
        }

        function showRSVPDashboard() {
            hideAllPages();
            document.getElementById('rsvpDashboardPage').style.display = 'block';
            loadRSVPData();
        }

        function hideAllPages() {
            document.getElementById('introPage').style.display = 'none';
            document.getElementById('appContent').style.display = 'none';
            document.getElementById('savedEvitesPage').style.display = 'none';
            document.getElementById('rsvpDashboardPage').style.display = 'none';
        }

        function loadSavedEvites() {
            const container = document.getElementById('savedEvitesList');
            if (savedEvites.length === 0) {
                container.innerHTML = '<p>No saved e-vites yet. Create your first one!</p>';
                return;
            }

            container.innerHTML = savedEvites.map(evite => `
                <div class="evite-card" onclick="loadEvite('${evite.id}')">
                    <div class="evite-title">${evite.title}</div>
                    <div class="evite-date">Created: ${evite.date}</div>
                    <div class="evite-stats">
                        <div class="stat-item">
                            <span>‚úÖ ${evite.rsvps.filter(r => r.status === 'accepted').length}</span>
                        </div>
                        <div class="stat-item">
                            <span>‚ùå ${evite.rsvps.filter(r => r.status === 'declined').length}</span>
                        </div>
                        <div class="stat-item">
                            <span>‚ùì ${evite.rsvps.filter(r => r.status === 'maybe').length}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadRSVPData() {
            const container = document.getElementById('rsvpList');
            const allRSVPs = savedEvites.flatMap(evite =>
                evite.rsvps.map(rsvp => ({...rsvp, eviteTitle: evite.title}))
            );

            if (allRSVPs.length === 0) {
                container.innerHTML = '<p>No RSVP activity yet.</p>';
                return;
            }

            container.innerHTML = allRSVPs.map(rsvp => `
                <div class="rsvp-item ${rsvp.status}">
                    <div>
                        <strong>${rsvp.name}</strong> - ${rsvp.eviteTitle}
                        <div style="font-size: 12px; color: #666;">${rsvp.email}</div>
                    </div>
                    <div class="rsvp-status ${rsvp.status}">${rsvp.status.toUpperCase()}</div>
                </div>
            `).join('');
        }

        function loadEvite(eviteId) {
            const evite = savedEvites.find(e => e.id == eviteId);
            if (evite) {
                startMode('evite');
                elements.occasion.value = evite.title;
                elements.recipientName.value = evite.recipientName;
                elements.senderName.value = evite.senderName;
                elements.wishText.value = evite.message;
                currentTemplate = evite.template;
                updateCardPreview();
            }
        }

        function saveUserData() {
            if (currentUser) {
                localStorage.setItem(`userData_${currentUser.id}`, JSON.stringify({
                    savedEvites: savedEvites
                }));
            }
        }

        function loadUserData() {
            if (currentUser) {
                const userData = localStorage.getItem(`userData_${currentUser.id}`);
                if (userData) {
                    const data = JSON.parse(userData);
                    savedEvites = data.savedEvites || [];
                }
            }
        }

        // Handle RSVP responses from URL parameters
        function handleRSVPFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const rsvpData = urlParams.get('rsvp');
            if (rsvpData) {
                try {
                    const eviteData = JSON.parse(decodeURIComponent(rsvpData));
                    showRSVPForm(eviteData);
                } catch (e) {
                    console.error('Invalid RSVP data:', e);
                }
            }
        }

        function showRSVPForm(eviteData) {
            // Create RSVP form overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 1000; display: flex;
                align-items: center; justify-content: center;
            `;
            overlay.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
                    <h2>üéâ You're Invited!</h2>
                    <h3>${eviteData.occasion}</h3>
                    <p><strong>From:</strong> ${eviteData.senderName}</p>
                    <p><strong>Message:</strong> ${eviteData.message}</p>

                    <div style="margin: 20px 0;">
                        <label>Your Name:</label>
                        <input type="text" id="rsvpName" style="width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px;">

                        <label>Your Email:</label>
                        <input type="email" id="rsvpEmail" style="width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px;">

                        <label>Will you attend?</label>
                        <div style="margin: 10px 0;">
                            <button onclick="submitRSVP('accepted')" style="background: #28a745; color: white; padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer;">‚úÖ Yes, I'll be there!</button>
                            <button onclick="submitRSVP('declined')" style="background: #dc3545; color: white; padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer;">‚ùå Sorry, can't make it</button>
                            <button onclick="submitRSVP('maybe')" style="background: #ffc107; color: black; padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer;">‚ùì Maybe</button>
                        </div>
                    </div>

                    <button onclick="closeRSVPForm()" style="background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; float: right;">Close</button>
                </div>
            `;
            document.body.appendChild(overlay);
            window.rsvpOverlay = overlay;
        }

        function submitRSVP(status) {
            const name = document.getElementById('rsvpName').value;
            const email = document.getElementById('rsvpEmail').value;

            if (!name || !email) {
                alert('Please fill in your name and email');
                return;
            }

            // In a real app, this would send to a backend
            console.log('RSVP Submitted:', { name, email, status });
            alert(`Thank you! Your RSVP (${status}) has been recorded.`);
            closeRSVPForm();
        }

        function closeRSVPForm() {
            if (window.rsvpOverlay) {
                document.body.removeChild(window.rsvpOverlay);
                window.rsvpOverlay = null;
            }
        }

        function updateCardPreview() {
            if (currentMode === 'simple') return;

            const templateType = currentMode;
            const template = templates[templateType][currentTemplate];

            if (!template) return;

            const recipientName = elements.recipientName.value || (currentMode === 'evite' ? 'Guest' : 'Someone Special');
            const senderName = elements.senderName.value || (currentMode === 'evite' ? 'Host' : 'Your Friend');
            const occasion = elements.occasion.value;

            if (currentMode === 'evite') {
                elements.cardTitle.textContent = occasion ?
                    `üéä ${occasion} üéâ` : template.title;

                elements.cardSubtitle.textContent =
                    `Dear ${recipientName}, ${template.subtitle.toLowerCase()}`;
            } else {
                elements.cardTitle.textContent = occasion ?
                    `üéâ Happy ${occasion}! üéÇ` : template.title;

                elements.cardSubtitle.textContent =
                    `Dear ${recipientName}, ${template.subtitle.toLowerCase()}`;
            }

            elements.footerMessage.textContent = template.footer;
            elements.senderDisplay.textContent = senderName;

            const headerGradient = `linear-gradient(135deg, ${template.colors.primary}, ${template.colors.secondary})`;
            elements.cardPreview.querySelector('.card-header').style.background = headerGradient;
        }

        function generateSessionId() {
            return 'BWC-' + Math.random().toString(36).substring(2, 8).toUpperCase() +
                   '-' + Date.now().toString(36).toUpperCase();
        }

        function initializeSession() {
            const existingSession = localStorage.getItem('birthdayWishSession');
            const now = new Date().getTime();

            if (existingSession) {
                const session = JSON.parse(existingSession);
                const sessionAge = now - session.startTime;
                const twelveHours = 12 * 60 * 60 * 1000;

                if (sessionAge < twelveHours) {
                    userSession = session;
                    loadSessionData();
                } else {
                    createNewSession();
                }
            } else {
                createNewSession();
            }

            updateSessionDisplay();
            startSessionTimer();
        }

        function createNewSession() {
            const now = new Date().getTime();
            userSession = {
                id: generateSessionId(),
                startTime: now,
                endTime: now + (12 * 60 * 60 * 1000),
                data: {
                    wishText: '',
                    animation: 'none',
                    fontSize: 60,
                    textColor: '#ffffff',
                    strokeColor: '#000000',
                    strokeWidth: 2,
                    fontFamily: 'Arial, sans-serif',
                    textPosition: 'center',
                    backgroundType: 'gradient',
                    gradientColor1: '#667eea',
                    gradientColor2: '#764ba2',
                    gradientDirection: 'linear-gradient(135deg,',
                    climateEffect: 'none',
                    particleIntensity: 5,
                    photoOpacity: 80
                }
            };
            saveSession();
        }

        function saveSession() {
            userSession.data = {
                wishText: elements.wishText.value,
                animation: elements.animation.value,
                fontSize: elements.fontSize.value,
                textColor: elements.textColor.value,
                strokeColor: elements.strokeColor.value,
                strokeWidth: elements.strokeWidth.value,
                fontFamily: elements.fontFamily.value,
                textPosition: elements.textPosition.value,
                backgroundType: elements.backgroundType.value,
                gradientColor1: elements.gradientColor1.value,
                gradientColor2: elements.gradientColor2.value,
                gradientDirection: elements.gradientDirection.value,
                climateEffect: elements.climateEffect.value,
                particleIntensity: elements.particleIntensity.value,
                photoOpacity: elements.photoOpacity.value
            };
            localStorage.setItem('birthdayWishSession', JSON.stringify(userSession));
        }

        function loadSessionData() {
            const data = userSession.data;
            elements.wishText.value = data.wishText || '';
            elements.animation.value = data.animation || 'none';
            elements.fontSize.value = data.fontSize || 60;
            elements.textColor.value = data.textColor || '#ffffff';
            elements.strokeColor.value = data.strokeColor || '#000000';
            elements.strokeWidth.value = data.strokeWidth || 2;
            elements.fontFamily.value = data.fontFamily || 'Arial, sans-serif';
            elements.textPosition.value = data.textPosition || 'center';
            elements.backgroundType.value = data.backgroundType || 'gradient';
            elements.gradientColor1.value = data.gradientColor1 || '#667eea';
            elements.gradientColor2.value = data.gradientColor2 || '#764ba2';
            elements.gradientDirection.value = data.gradientDirection || 'linear-gradient(135deg,';
            elements.climateEffect.value = data.climateEffect || 'none';
            elements.particleIntensity.value = data.particleIntensity || 5;
            elements.photoOpacity.value = data.photoOpacity || 80;

            updateRangeValues();
            updateCharCount();
        }

        function updateSessionDisplay() {
            if (elements.sessionId) elements.sessionId.textContent = userSession.id;
            if (elements.sessionIdToast) elements.sessionIdToast.textContent = userSession.id;
        }

        function startSessionTimer() {
            setInterval(() => {
                const now = new Date().getTime();
                const timeLeft = userSession.endTime - now;

                if (timeLeft <= 0) {
                    resetSession();
                    return;
                }

                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                if (elements.sessionTimer) elements.sessionTimer.textContent = timeString;
                if (elements.sessionTimerToast) elements.sessionTimerToast.textContent = timeString;
            }, 1000);
        }

        function resetSession() {
            localStorage.removeItem('birthdayWishSession');
            createNewSession();
            loadSessionData();
            updateSessionDisplay();
            updateCanvas();
            backgroundImage = null;
            elements.climateOverlay.innerHTML = '';
        }

        const profanityList = [
            'damn', 'hell', 'crap', 'stupid', 'idiot', 'moron', 'dumb', 'hate', 'suck', 'loser',
            'shut up', 'die', 'kill', 'death', 'murder', 'bloody', 'bastard', 'bitch', 'ass',
            'piss', 'shit', 'fuck', 'fucking', 'fucked', 'motherfucker', 'cocksucker',
            'dickhead', 'asshole', 'whore', 'slut', 'retard', 'gay', 'faggot', 'nigger',
            'chink', 'spic', 'kike', 'wetback', 'gook', 'raghead', 'towelhead', 'camel jockey'
        ];

        function containsProfanity(text) {
            const lowerText = text.toLowerCase();
            return profanityList.some(word => {
                const regex = new RegExp(`\\b${word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, 'i');
                return regex.test(lowerText);
            });
        }

        function showWarning() {
            elements.warningMessage.classList.add('show');
            setTimeout(() => {
                elements.warningMessage.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            }, 100);
        }

        function closeWarning() {
            elements.warningMessage.classList.remove('show');
        }

        function validateAndUpdateText() {
            const text = elements.wishText.value;

            if (containsProfanity(text)) {
                showWarning();
                elements.wishText.value = text.slice(0, -1);
                return false;
            }

            closeWarning();
            return true;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');

            const tabMap = {
                'text': 'textTab',
                'media': 'mediaTab',
                'climate': 'climateTab'
            };

            if (tabMap[tabName]) {
                document.getElementById(tabMap[tabName]).classList.add('active');
            }
        }

        function updateCanvas() {
            const activeCanvas = currentMode === 'simple' ? simpleCanvas : canvas;
            const activeCtx = currentMode === 'simple' ? simpleCtx : ctx;

            activeCtx.clearRect(0, 0, activeCanvas.width, activeCanvas.height);

            drawBackground(activeCtx, activeCanvas);
            drawBackgroundImage(activeCtx, activeCanvas);
            drawText(activeCtx, activeCanvas);

            if (currentMode === 'simple') {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBackground(ctx, canvas);
                drawBackgroundImage(ctx, canvas);
                drawText(ctx, canvas);
            }
        }

        function drawBackground(context, canvasEl) {
            const bgType = elements.backgroundType.value;

            if (bgType === 'photo' && backgroundImage) {
                return;
            }

            if (bgType === 'gradient') {
                const direction = elements.gradientDirection.value;
                const color1 = elements.gradientColor1.value;
                const color2 = elements.gradientColor2.value;

                let gradient;
                if (direction.includes('radial')) {
                    gradient = context.createRadialGradient(canvasEl.width/2, canvasEl.height/2, 0, canvasEl.width/2, canvasEl.height/2, Math.max(canvasEl.width, canvasEl.height)/2);
                } else if (direction.includes('90deg')) {
                    gradient = context.createLinearGradient(0, 0, canvasEl.width, 0);
                } else if (direction.includes('0deg')) {
                    gradient = context.createLinearGradient(0, 0, 0, canvasEl.height);
                } else {
                    gradient = context.createLinearGradient(0, 0, canvasEl.width, canvasEl.height);
                }

                gradient.addColorStop(0, color1);
                gradient.addColorStop(1, color2);
                context.fillStyle = gradient;
            } else {
                context.fillStyle = elements.gradientColor1.value;
            }

            context.fillRect(0, 0, canvasEl.width, canvasEl.height);
        }

        function drawBackgroundImage(context, canvasEl) {
            if (backgroundImage) {
                const opacity = elements.photoOpacity.value / 100;
                context.globalAlpha = opacity;

                const aspectRatio = backgroundImage.width / backgroundImage.height;
                const canvasRatio = canvasEl.width / canvasEl.height;

                let drawWidth, drawHeight, offsetX, offsetY;

                if (aspectRatio > canvasRatio) {
                    drawHeight = canvasEl.height;
                    drawWidth = drawHeight * aspectRatio;
                    offsetX = (canvasEl.width - drawWidth) / 2;
                    offsetY = 0;
                } else {
                    drawWidth = canvasEl.width;
                    drawHeight = drawWidth / aspectRatio;
                    offsetX = 0;
                    offsetY = (canvasEl.height - drawHeight) / 2;
                }

                context.drawImage(backgroundImage, offsetX, offsetY, drawWidth, drawHeight);
                context.globalAlpha = 1;
            }
        }

        function wrapText(context, text, x, y, maxWidth, lineHeight) {
            const words = text.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                const word = words[i];
                const width = context.measureText(currentLine + ' ' + word).width;
                if (width < maxWidth) {
                    currentLine += ' ' + word;
                } else {
                    lines.push(currentLine);
                    currentLine = word;
                }
            }
            lines.push(currentLine);

            // Calculate starting Y position to center the text block
            const totalHeight = lines.length * lineHeight;
            const startY = y - (totalHeight / 2) + (lineHeight / 2);

            return { lines, startY };
        }

        function drawText(context, canvasEl) {
            const text = elements.wishText.value || 'Happy Birthday! üéâ';
            const fontSize = elements.fontSize.value;
            const fontFamily = elements.fontFamily.value;
            const textColor = elements.textColor.value;
            const strokeColor = elements.strokeColor.value;
            const strokeWidth = elements.strokeWidth.value;
            const position = elements.textPosition.value;

            context.font = `bold ${fontSize}px ${fontFamily}`;
            context.textAlign = 'center';
            context.textBaseline = 'middle';

            let x = canvasEl.width / 2;
            let y = canvasEl.height / 2;
            let maxWidth = canvasEl.width * 0.8; // 80% of canvas width
            const lineHeight = fontSize * 1.2;

            switch (position) {
                case 'top':
                    y = fontSize * 2;
                    context.textBaseline = 'top';
                    break;
                case 'bottom':
                    y = canvasEl.height - fontSize * 2;
                    context.textBaseline = 'bottom';
                    break;
                case 'left':
                    x = fontSize;
                    context.textAlign = 'left';
                    maxWidth = canvasEl.width * 0.9;
                    break;
                case 'right':
                    x = canvasEl.width - fontSize;
                    context.textAlign = 'right';
                    maxWidth = canvasEl.width * 0.9;
                    break;
            }

            const wrappedText = wrapText(context, text, x, y, maxWidth, lineHeight);

            // Draw each line
            wrappedText.lines.forEach((line, index) => {
                const lineY = wrappedText.startY + (index * lineHeight);

                if (strokeWidth > 0) {
                    context.strokeStyle = strokeColor;
                    context.lineWidth = strokeWidth;
                    context.strokeText(line, x, lineY);
                }

                context.fillStyle = textColor;
                context.fillText(line, x, lineY);
            });
        }

        function createParticle(type) {
            const particle = {
                x: Math.random() * canvas.width,
                y: -20,
                speed: Math.random() * 3 + 1,
                size: Math.random() * 10 + 5,
                type: type
            };

            return particle;
        }

        function updateParticles() {
            const climateType = elements.climateEffect.value;
            const intensity = elements.particleIntensity.value;

            if (climateType === 'none') {
                elements.climateOverlay.innerHTML = '';
                return;
            }

            if (Math.random() < intensity / 20) {
                const particle = document.createElement('div');
                particle.className = `particle ${climateType === 'snow' ? 'snowflake' :
                                                climateType === 'rain' ? 'raindrop' :
                                                climateType === 'hearts' ? 'heart' : 'star'}`;

                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDuration = (Math.random() * 3 + 2) + 's';
                particle.style.animationDelay = Math.random() * 2 + 's';

                if (climateType === 'snow') {
                    particle.textContent = '‚ùÑ';
                } else if (climateType === 'hearts') {
                    particle.textContent = 'üíñ';
                } else if (climateType === 'stars') {
                    particle.textContent = '‚≠ê';
                }

                elements.climateOverlay.appendChild(particle);

                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 5000);
            }
        }

        function animate() {
            updateCanvas();
            updateParticles();
            animationId = requestAnimationFrame(animate);
        }

        function downloadImage(format) {
            const activeCanvas = currentMode === 'simple' ? simpleCanvas : canvas;
            const link = document.createElement('a');
            const filename = `birthday-wish.${format}`;

            if (format === 'jpeg') {
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = activeCanvas.width;
                tempCanvas.height = activeCanvas.height;

                tempCtx.fillStyle = 'white';
                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                tempCtx.drawImage(activeCanvas, 0, 0);

                link.href = tempCanvas.toDataURL('image/jpeg', 0.9);
            } else {
                link.href = activeCanvas.toDataURL('image/png');
            }

            link.download = filename;
            link.click();
        }

        function generateShareableLink() {
            const cardData = {
                recipientName: elements.recipientName.value,
                senderName: elements.senderName.value,
                occasion: elements.occasion.value,
                message: elements.wishText.value,
                template: currentTemplate,
                mode: currentMode
            };

            const encodedData = btoa(JSON.stringify(cardData));
            const baseUrl = window.location.origin + window.location.pathname;
            return `${baseUrl}?card=${encodedData}`;
        }

        function copyToClipboard() {
            const shareUrl = generateShareableLink();
            elements.shareableLink.textContent = shareUrl;

            navigator.clipboard.writeText(shareUrl).then(() => {
                elements.shareableLink.textContent = '‚úÖ Link copied to clipboard!';
                setTimeout(() => {
                    elements.shareableLink.textContent = shareUrl;
                }, 2000);
            });
        }

        function shareViaEmail() {
            const shareUrl = generateShareableLink();
            const recipientName = elements.recipientName.value || 'Someone Special';
            const subject = `üéâ Happy Birthday ${recipientName}! üéÇ`;
            const body = `I created a special birthday card for you! Click here to view it: ${shareUrl}`;

            window.open(`mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`);
        }

        function shareViaWhatsApp() {
            const shareUrl = generateShareableLink();
            const recipientName = elements.recipientName.value || 'Someone Special';
            const message = `üéâ Happy Birthday ${recipientName}! üéÇ\nI made you a special birthday card: ${shareUrl}`;

            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`);
        }

        function shareViaFacebook() {
            const shareUrl = generateShareableLink();
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`);
        }

        function shareViaTwitter() {
            const shareUrl = generateShareableLink();
            const recipientName = elements.recipientName.value || 'Someone Special';
            const message = `üéâ Happy Birthday ${recipientName}! üéÇ I created a special birthday card! ${shareUrl}`;

            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}`);
        }

        function downloadFullCard() {
            if (currentMode === 'advanced') {
                downloadImage('png');
            } else {
                downloadImage('png');
            }
        }

        function randomizeColors() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7', '#fd79a8', '#00b894', '#fdcb6e', '#ff7675', '#74b9ff', '#a29bfe', '#fd79a8', '#e17055'];

            elements.textColor.value = colors[Math.floor(Math.random() * colors.length)];
            elements.gradientColor1.value = colors[Math.floor(Math.random() * colors.length)];
            elements.gradientColor2.value = colors[Math.floor(Math.random() * colors.length)];
            elements.strokeColor.value = colors[Math.floor(Math.random() * colors.length)];

            updateCanvas();
        }

        function randomizeAnimation() {
            const animations = ['bounce', 'pulse', 'shake', 'glow', 'rainbow', 'rotate', 'fadeIn', 'slideIn'];
            elements.animation.value = animations[Math.floor(Math.random() * animations.length)];
        }

        function printWish() {
            window.print();
        }

        function resetAll() {
            elements.wishText.value = '';
            elements.animation.value = 'none';
            elements.fontSize.value = 60;
            elements.textColor.value = '#ffffff';
            elements.strokeColor.value = '#000000';
            elements.strokeWidth.value = 2;
            elements.fontFamily.value = 'Arial, sans-serif';
            elements.textPosition.value = 'center';
            elements.backgroundType.value = 'gradient';
            elements.gradientColor1.value = '#667eea';
            elements.gradientColor2.value = '#764ba2';
            elements.gradientDirection.value = 'linear-gradient(135deg,';
            elements.climateEffect.value = 'none';
            elements.particleIntensity.value = 5;
            elements.photoOpacity.value = 80;

            backgroundImage = null;
            elements.climateOverlay.innerHTML = '';

            updateRangeValues();
            updateCharCount();
            updateCanvas();
        }

        function updateRangeValues() {
            elements.fontSizeValue.textContent = elements.fontSize.value;
            elements.strokeWidthValue.textContent = elements.strokeWidth.value;
            elements.photoOpacityValue.textContent = elements.photoOpacity.value;
            elements.particleIntensityValue.textContent = elements.particleIntensity.value;
        }

        function updateCharCount() {
            elements.charCount.textContent = elements.wishText.value.length;
        }

        elements.wishText.addEventListener('input', () => {
            if (validateAndUpdateText()) {
                updateCharCount();
                updateCanvas();
                saveSession();
            }
        });

        elements.photoUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        backgroundImage = img;
                        updateCanvas();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        elements.evitePhoto.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        backgroundImage = img;
                        updateCanvas();
                        saveSession();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        [elements.fontSize, elements.strokeWidth, elements.photoOpacity, elements.particleIntensity].forEach(slider => {
            slider.addEventListener('input', () => {
                updateRangeValues();
                updateCanvas();
                saveSession();
            });
        });

        [elements.animation, elements.textColor, elements.strokeColor, elements.fontFamily,
         elements.textPosition, elements.backgroundType, elements.gradientColor1,
         elements.gradientColor2, elements.gradientDirection, elements.climateEffect].forEach(control => {
            control.addEventListener('change', () => {
                updateCanvas();
                saveSession();
            });
        });

        [elements.recipientName, elements.senderName, elements.occasion, elements.eventDate].forEach(input => {
            input.addEventListener('input', () => {
                updateCardPreview();
                saveSession();
            });
        });

        elements.templateGrid.addEventListener('click', (e) => {
            const templateCard = e.target.closest('.template-card');
            if (templateCard) {
                const template = templateCard.dataset.template;
                selectTemplate(template);
            }
        });

        initializeSession();
        updateRangeValues();
        updateCharCount();
        updateCanvas();
        animate();

        // Initialize RSVP and authentication
        handleRSVPFromURL();

        // Set Google OAuth client ID (replace with your actual client ID)
        document.getElementById('g_id_onload').setAttribute('data-client_id', '132435517223-cgvv1befsebst3113v3nh9ie9hg9ur9u.apps.googleusercontent.com');
    </script>
</body>
</html>