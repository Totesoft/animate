<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Greeting Card Creator - Birthday Wishes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .text-input-section {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 30px;
            border-radius: 20px;
            color: white;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        }

        .text-input-section h2 {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .main-text-input {
            width: 100%;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            resize: vertical;
            min-height: 120px;
            font-family: Arial, sans-serif;
        }

        .main-text-input:focus {
            outline: none;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .main-text-input::placeholder {
            color: #999;
            font-style: italic;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .controls-collapsed {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 15px;
        }

        .control-group h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 1em;
        }

        .right-panel {
            display: flex;
            flex-direction: column;
        }

        .canvas-section {
            flex: 1;
        }

        .session-info {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }

        .session-info strong {
            display: block;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .timer {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 18px;
            margin-top: 5px;
        }

        .greeting-info-section {
            background: linear-gradient(135deg, #e17055, #f39c12);
            padding: 25px;
            border-radius: 20px;
            color: white;
            margin-bottom: 20px;
            box-shadow: 0 15px 35px rgba(225, 112, 85, 0.3);
        }

        .greeting-info-section h2 {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.4em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .info-input {
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            transition: all 0.3s;
        }

        .info-input:focus {
            outline: none;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .greeting-templates {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            padding: 20px;
            border-radius: 15px;
            color: white;
            margin-bottom: 15px;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .template-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
        }

        .template-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .template-card.active {
            border-color: white;
            background: rgba(255, 255, 255, 0.2);
        }

        .template-emoji {
            font-size: 24px;
            display: block;
            margin-bottom: 8px;
        }

        .card-preview {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .card-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .card-header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .card-header p {
            opacity: 0.9;
        }

        .card-footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #eee;
        }

        .signature {
            font-style: italic;
            color: #666;
            margin-top: 10px;
        }

        .sharing-section {
            background: linear-gradient(135deg, #00b894, #00cec9);
            padding: 20px;
            border-radius: 15px;
            color: white;
            text-align: center;
            margin-top: 20px;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .share-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s;
            text-decoration: none;
        }

        .share-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .share-link {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 12px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
            cursor: pointer;
        }

        .share-link:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .session-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(46, 204, 113, 0.3);
            z-index: 1000;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 12px;
            min-width: 200px;
        }

        .session-toast.collapsed {
            transform: translateX(calc(100% - 40px));
        }

        .session-toast .toast-icon {
            font-size: 18px;
            margin-right: 10px;
        }

        .session-toast.collapsed .toast-content {
            display: none;
        }

        .session-toast.collapsed .toast-icon {
            margin: 0;
        }

        .toast-content {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .template-section-right {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            padding: 20px;
            border-radius: 15px;
            color: white;
            margin-bottom: 20px;
        }

        .template-section-right h3 {
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.1em;
        }

        .template-grid-compact {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .template-card-compact {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 10px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 10px;
        }

        .template-card-compact:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .template-card-compact.active {
            border-color: white;
            background: rgba(255, 255, 255, 0.2);
        }

        .template-emoji-compact {
            font-size: 18px;
            display: block;
            margin-bottom: 5px;
        }

        .top-section {
            background: white;
            border-radius: 0 0 20px 20px;
            padding: 25px 30px;
            margin: 0 -30px 30px -30px;
            border-bottom: 1px solid #eee;
        }

        .mode-selector {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .mode-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px 10px 0 0;
            border-bottom: 2px solid #eee;
            overflow: hidden;
            margin: 0 -30px;
            margin-bottom: 0;
        }

        .mode-tab {
            flex: 1;
            background: transparent;
            color: #666;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 14px;
            border-bottom: 3px solid transparent;
        }

        .mode-tab:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .mode-tab.active {
            background: white;
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .simple-mode .greeting-info-section,
        .simple-mode .greeting-templates,
        .simple-mode .card-preview {
            display: none !important;
        }

        .advanced-mode .right-panel .card-preview {
            display: block !important;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
            font-size: 14px;
        }

        input[type="text"], select, input[type="range"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        input[type="color"] {
            width: 50px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            cursor: pointer;
        }

        .color-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .gradient-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .preview-container {
            position: relative;
            margin-bottom: 30px;
        }

        .canvas-container {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        #mainCanvas {
            display: block;
            max-width: 100%;
            height: auto;
            border-radius: 15px;
        }

        .climate-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            border-radius: 15px;
        }

        .button-group {
            text-align: center;
            margin-top: 20px;
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .char-counter {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .range-value {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin-top: 5px;
        }

        .download-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .warning-message {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
            animation: gentleShake 0.5s ease-in-out;
            display: none;
        }

        .warning-message.show {
            display: block;
        }

        .warning-message h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .warning-message p {
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .close-warning {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .close-warning:hover {
            background: white;
            color: #ff6b6b;
        }

        @keyframes gentleShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-weight: bold;
            color: #666;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .particle {
            position: absolute;
            pointer-events: none;
        }

        .snowflake {
            color: white;
            font-size: 20px;
            animation: snowfall linear infinite;
        }

        .raindrop {
            width: 2px;
            height: 20px;
            background: rgba(173, 216, 230, 0.7);
            animation: rainfall linear infinite;
        }

        .heart {
            color: #ff69b4;
            font-size: 16px;
            animation: heartfall linear infinite;
        }

        .star {
            color: #ffd700;
            font-size: 14px;
            animation: starfall linear infinite;
        }

        @keyframes snowfall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes rainfall {
            0% {
                transform: translateY(-100vh);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh);
                opacity: 0;
            }
        }

        @keyframes heartfall {
            0% {
                transform: translateY(-100vh) scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: translateY(100vh) scale(0.8);
                opacity: 0;
            }
        }

        @keyframes starfall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-30px);
            }
            60% {
                transform: translateY(-15px);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }
            10%, 30%, 50%, 70%, 90% {
                transform: translateX(-10px);
            }
            20%, 40%, 60%, 80% {
                transform: translateX(10px);
            }
        }

        @keyframes glow {
            0% {
                filter: drop-shadow(0 0 5px currentColor);
            }
            50% {
                filter: drop-shadow(0 0 20px currentColor) drop-shadow(0 0 30px currentColor);
            }
            100% {
                filter: drop-shadow(0 0 5px currentColor);
            }
        }

        @keyframes rainbow {
            0% { color: #ff0000; }
            16% { color: #ff8000; }
            33% { color: #ffff00; }
            50% { color: #00ff00; }
            66% { color: #0080ff; }
            83% { color: #8000ff; }
            100% { color: #ff0000; }
        }

        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideIn {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(0);
            }
        }

        @media print {
            body {
                background: white !important;
            }
            .controls, .button-group, .tab-container {
                display: none !important;
            }
            .container {
                box-shadow: none !important;
                padding: 0 !important;
            }
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            .controls-collapsed {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .controls-collapsed {
                grid-template-columns: 1fr;
            }

            .text-input-section {
                padding: 20px;
            }

            .main-text-input {
                font-size: 16px;
                padding: 15px;
                min-height: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>💌 Birthday Wish Creator 🎂</h1>
            <p>Create beautiful birthday wishes - choose Simple Design or Advanced E-Greeting Card!</p>
        </div>

        <div class="mode-tabs">
            <button class="mode-tab active" id="simpleMode" onclick="switchMode('simple')">
                🎨 Simple Wish Design
            </button>
            <button class="mode-tab" id="advancedMode" onclick="switchMode('advanced')">
                💌 Advanced E-Greeting
            </button>
        </div>

        <div class="top-section" id="topSection">
            <div class="greeting-info-section" id="advancedInfo" style="display: none;">
                <h2>📝 Greeting Card Details</h2>
                <div class="info-grid">
                    <input type="text" id="recipientName" class="info-input" placeholder="Recipient's Name" maxlength="50">
                    <input type="text" id="senderName" class="info-input" placeholder="Your Name" maxlength="50">
                    <input type="text" id="occasion" class="info-input" placeholder="Occasion (e.g., 25th Birthday)" maxlength="50">
                    <input type="date" id="eventDate" class="info-input">
                </div>
            </div>

            <div class="greeting-templates" id="advancedTemplates" style="display: none;">
                <h3 style="margin-bottom: 10px; text-align: center;">🎨 Choose Template</h3>
                <div class="template-grid" id="templateGrid">
                    <div class="template-card active" data-template="classic">
                        <span class="template-emoji">🎂</span>
                        Classic
                    </div>
                    <div class="template-card" data-template="party">
                        <span class="template-emoji">🎉</span>
                        Party
                    </div>
                    <div class="template-card" data-template="elegant">
                        <span class="template-emoji">✨</span>
                        Elegant
                    </div>
                    <div class="template-card" data-template="fun">
                        <span class="template-emoji">🎈</span>
                        Fun
                    </div>
                    <div class="template-card" data-template="love">
                        <span class="template-emoji">💖</span>
                        Love
                    </div>
                    <div class="template-card" data-template="cute">
                        <span class="template-emoji">🥳</span>
                        Cute
                    </div>
                </div>
            </div>
        </div>

        <div class="warning-message" id="warningMessage">
            <h3>🌟 Let's Keep It Positive! 🌟</h3>
            <p>This app is designed to create beautiful, heartwarming birthday wishes that spread joy and happiness. Please use kind, positive words that would make someone smile on their special day.</p>
            <button class="close-warning" onclick="closeWarning()">I Understand</button>
        </div>

        <div class="main-layout">
            <div class="left-panel">
                <div class="text-input-section">
                    <h2>✨ Your Personal Message</h2>
                    <textarea class="main-text-input" id="wishText" placeholder="Write your heartfelt birthday message here... 🎉&#10;&#10;Make this birthday extra special with your words!" maxlength="255"></textarea>
                    <div class="char-counter" style="text-align: center; margin-top: 15px; color: rgba(255,255,255,0.8);">
                        Characters: <span id="charCount">0</span>/255
                    </div>
                </div>

                <div class="tab-container">
                    <button class="tab active" onclick="switchTab('text')">📝 Animation</button>
                    <button class="tab" onclick="switchTab('media')">🖼️ Media</button>
                    <button class="tab" onclick="switchTab('climate')">🌦️ Effects</button>
                </div>

                <div class="controls">
                    <div id="textTab" class="tab-content active">
                        <div class="controls-collapsed">
                            <div class="control-group">
                                <h3>✨ Animation</h3>
                                <div class="input-group">
                                    <label for="animation">Animation:</label>
                                    <select id="animation">
                                        <option value="none">No Animation</option>
                                        <option value="bounce">Bounce</option>
                                        <option value="pulse">Pulse</option>
                                        <option value="shake">Shake</option>
                                        <option value="glow">Glow</option>
                                        <option value="rainbow">Rainbow</option>
                                        <option value="rotate">Rotate</option>
                                        <option value="fadeIn">Fade In</option>
                                        <option value="slideIn">Slide In</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="fontSize">Font Size:</label>
                                    <input type="range" id="fontSize" min="20" max="120" value="60">
                                    <div class="range-value">Size: <span id="fontSizeValue">60</span>px</div>
                                </div>
                            </div>
                            <div class="control-group">
                                <h3>🎨 Text Style</h3>
                                <div class="input-group">
                                    <label for="fontFamily">Font:</label>
                                    <select id="fontFamily">
                                        <option value="Arial, sans-serif">Arial</option>
                                        <option value="'Times New Roman', serif">Times New Roman</option>
                                        <option value="'Courier New', monospace">Courier New</option>
                                        <option value="'Comic Sans MS', cursive">Comic Sans MS</option>
                                        <option value="'Impact', fantasy">Impact</option>
                                        <option value="'Brush Script MT', cursive">Brush Script</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="textPosition">Position:</label>
                                    <select id="textPosition">
                                        <option value="center">Center</option>
                                        <option value="top">Top</option>
                                        <option value="bottom">Bottom</option>
                                        <option value="left">Left</option>
                                        <option value="right">Right</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="mediaTab" class="tab-content">
                        <div class="controls-collapsed">
                            <div class="control-group">
                                <h3>🖼️ Photo Upload</h3>
                                <div class="input-group">
                                    <label for="photoUpload">Background Photo:</label>
                                    <input type="file" id="photoUpload" accept="image/*">
                                </div>
                                <div class="input-group">
                                    <label for="photoOpacity">Photo Opacity:</label>
                                    <input type="range" id="photoOpacity" min="0" max="100" value="80">
                                    <div class="range-value">Opacity: <span id="photoOpacityValue">80</span>%</div>
                                </div>
                            </div>
                            <div class="control-group">
                                <h3>🎨 Colors</h3>
                                <div class="input-group">
                                    <label for="textColor">Text Color:</label>
                                    <input type="color" id="textColor" value="#ffffff">
                                </div>
                                <div class="input-group">
                                    <label for="strokeColor">Text Stroke:</label>
                                    <input type="color" id="strokeColor" value="#000000">
                                </div>
                                <div class="input-group">
                                    <label for="strokeWidth">Stroke Width:</label>
                                    <input type="range" id="strokeWidth" min="0" max="10" value="2">
                                    <div class="range-value">Width: <span id="strokeWidthValue">2</span>px</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="climateTab" class="tab-content">
                        <div class="controls-collapsed">
                            <div class="control-group">
                                <h3>🌦️ Climate Effects</h3>
                                <div class="input-group">
                                    <label for="climateEffect">Effect:</label>
                                    <select id="climateEffect">
                                        <option value="none">No Effect</option>
                                        <option value="snow">Snow ❄️</option>
                                        <option value="rain">Rain 🌧️</option>
                                        <option value="hearts">Hearts 💕</option>
                                        <option value="stars">Stars ⭐</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="particleIntensity">Intensity:</label>
                                    <input type="range" id="particleIntensity" min="1" max="10" value="5">
                                    <div class="range-value">Level: <span id="particleIntensityValue">5</span></div>
                                </div>
                            </div>
                            <div class="control-group">
                                <h3>🌈 Background</h3>
                                <div class="input-group">
                                    <label for="backgroundType">Type:</label>
                                    <select id="backgroundType">
                                        <option value="solid">Solid Color</option>
                                        <option value="gradient">Gradient</option>
                                        <option value="photo">Photo Only</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="gradientColor1">Color 1:</label>
                                    <input type="color" id="gradientColor1" value="#667eea">
                                </div>
                                <div class="input-group">
                                    <label for="gradientColor2">Color 2:</label>
                                    <input type="color" id="gradientColor2" value="#764ba2">
                                </div>
                                <div class="input-group">
                                    <label for="gradientDirection">Direction:</label>
                                    <select id="gradientDirection">
                                        <option value="linear-gradient(135deg,">Diagonal</option>
                                        <option value="linear-gradient(90deg,">Horizontal</option>
                                        <option value="linear-gradient(0deg,">Vertical</option>
                                        <option value="radial-gradient(circle,">Radial</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <div class="template-section-right" id="templateSectionRight" style="display: none;">
                    <h3>🎨 Choose Template</h3>
                    <div class="template-grid-compact" id="templateGridCompact">
                        <div class="template-card-compact active" data-template="classic">
                            <span class="template-emoji-compact">🎂</span>
                            Classic
                        </div>
                        <div class="template-card-compact" data-template="party">
                            <span class="template-emoji-compact">🎉</span>
                            Party
                        </div>
                        <div class="template-card-compact" data-template="elegant">
                            <span class="template-emoji-compact">✨</span>
                            Elegant
                        </div>
                        <div class="template-card-compact" data-template="fun">
                            <span class="template-emoji-compact">🎈</span>
                            Fun
                        </div>
                        <div class="template-card-compact" data-template="love">
                            <span class="template-emoji-compact">💖</span>
                            Love
                        </div>
                        <div class="template-card-compact" data-template="cute">
                            <span class="template-emoji-compact">🥳</span>
                            Cute
                        </div>
                    </div>
                </div>

                <div class="card-preview" id="cardPreview" style="display: none;">
                    <div class="card-header" id="cardHeader">
                        <h1 id="cardTitle">🎉 Happy Birthday! 🎂</h1>
                        <p id="cardSubtitle">Hope your special day is wonderful!</p>
                    </div>
                    <div class="canvas-section">
                        <div class="canvas-container">
                            <canvas id="mainCanvas" width="800" height="600"></canvas>
                            <div class="climate-overlay" id="climateOverlay"></div>
                        </div>
                    </div>
                    <div class="card-footer" id="cardFooter">
                        <div style="color: #333; font-weight: bold;" id="footerMessage">
                            Wishing you joy and happiness on your special day! 🎈
                        </div>
                        <div class="signature" id="cardSignature">
                            With love, <span id="senderDisplay">Someone Special</span> ❤️
                        </div>
                    </div>
                </div>

                <div class="canvas-section" id="simpleCanvas">
                    <div class="canvas-container">
                        <canvas id="simpleMainCanvas" width="800" height="600"></canvas>
                        <div class="climate-overlay" id="simpleClimateOverlay"></div>
                    </div>
                </div>

                <div class="sharing-section" id="sharingSection" style="display: none;">
                    <h3>📤 Share Your E-Greeting</h3>
                    <p>Share this beautiful card with your loved one!</p>
                    <div class="share-link" id="shareableLink" onclick="copyToClipboard()">
                        Click to generate shareable link
                    </div>
                    <div class="share-buttons">
                        <button class="share-btn" onclick="shareViaEmail()">📧 Email</button>
                        <button class="share-btn" onclick="shareViaWhatsApp()">📱 WhatsApp</button>
                        <button class="share-btn" onclick="shareViaFacebook()">📘 Facebook</button>
                        <button class="share-btn" onclick="shareViaTwitter()">🐦 Twitter</button>
                        <button class="share-btn" onclick="downloadFullCard()">💾 Download Card</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="button-group">
            <button onclick="randomizeColors()">🎲 Random Colors</button>
            <button onclick="randomizeAnimation()">🎪 Random Animation</button>
            <button onclick="printWish()">🖨️ Print Wish</button>
            <button onclick="resetAll()">🔄 Reset All</button>
        </div>

        <div class="download-buttons">
            <button onclick="downloadImage('png')">📥 Download PNG</button>
            <button onclick="downloadImage('jpeg')">📥 Download JPG</button>
        </div>

        <div class="session-toast" id="sessionToast" onclick="toggleSessionToast()">
            <div class="toast-icon">⏱️</div>
            <div class="toast-content">
                <div><strong>Session:</strong> <span id="sessionIdToast">Loading...</span></div>
                <div><strong>Time:</strong> <span id="sessionTimerToast">12:00:00</span></div>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'simple';
        let currentTemplate = 'classic';

        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const simpleCanvas = document.getElementById('simpleMainCanvas');
        const simpleCtx = simpleCanvas.getContext('2d');

        let backgroundImage = null;
        let animationId = null;
        let particles = [];

        const greetingTemplates = {
            classic: {
                title: '🎉 Happy Birthday! 🎂',
                subtitle: 'Hope your special day is wonderful!',
                footer: 'Wishing you joy and happiness on your special day! 🎈',
                colors: { primary: '#667eea', secondary: '#764ba2' },
                defaultAnimation: 'bounce'
            },
            party: {
                title: '🎊 Let\'s Party! 🥳',
                subtitle: 'It\'s time to celebrate YOU!',
                footer: 'Hope your birthday is as awesome as you are! 🎉',
                colors: { primary: '#ff6b6b', secondary: '#ffa726' },
                defaultAnimation: 'shake'
            },
            elegant: {
                title: '✨ Happy Birthday ✨',
                subtitle: 'May this year bring you endless joy',
                footer: 'With warmest wishes on your special day 🌟',
                colors: { primary: '#a29bfe', secondary: '#6c5ce7' },
                defaultAnimation: 'glow'
            },
            fun: {
                title: '🎈 Birthday Fun! 🎈',
                subtitle: 'Another year of amazing adventures!',
                footer: 'Keep being awesome and have a blast! 🚀',
                colors: { primary: '#00cec9', secondary: '#00b894' },
                defaultAnimation: 'pulse'
            },
            love: {
                title: '💖 Happy Birthday Darling! 💖',
                subtitle: 'You mean the world to me',
                footer: 'Sending you all my love on your birthday! 💕',
                colors: { primary: '#fd79a8', secondary: '#e84393' },
                defaultAnimation: 'rainbow'
            },
            cute: {
                title: '🥳 Cutie\'s Birthday! 🧁',
                subtitle: 'You\'re simply adorable!',
                footer: 'Hope your day is as sweet as cake! 🍰',
                colors: { primary: '#fdcb6e', secondary: '#e17055' },
                defaultAnimation: 'rotate'
            }
        };

        let userSession = {
            id: '',
            startTime: null,
            endTime: null,
            data: {}
        };

        const elements = {
            wishText: document.getElementById('wishText'),
            charCount: document.getElementById('charCount'),
            animation: document.getElementById('animation'),
            fontSize: document.getElementById('fontSize'),
            fontSizeValue: document.getElementById('fontSizeValue'),
            textColor: document.getElementById('textColor'),
            strokeColor: document.getElementById('strokeColor'),
            strokeWidth: document.getElementById('strokeWidth'),
            strokeWidthValue: document.getElementById('strokeWidthValue'),
            fontFamily: document.getElementById('fontFamily'),
            photoUpload: document.getElementById('photoUpload'),
            photoOpacity: document.getElementById('photoOpacity'),
            photoOpacityValue: document.getElementById('photoOpacityValue'),
            textPosition: document.getElementById('textPosition'),
            backgroundType: document.getElementById('backgroundType'),
            gradientColor1: document.getElementById('gradientColor1'),
            gradientColor2: document.getElementById('gradientColor2'),
            gradientDirection: document.getElementById('gradientDirection'),
            climateEffect: document.getElementById('climateEffect'),
            particleIntensity: document.getElementById('particleIntensity'),
            particleIntensityValue: document.getElementById('particleIntensityValue'),
            climateOverlay: document.getElementById('climateOverlay'),
            warningMessage: document.getElementById('warningMessage'),
            sessionId: document.getElementById('sessionId'),
            sessionTimer: document.getElementById('sessionTimer'),
            sessionIdToast: document.getElementById('sessionIdToast'),
            sessionTimerToast: document.getElementById('sessionTimerToast'),
            sessionToast: document.getElementById('sessionToast'),
            recipientName: document.getElementById('recipientName'),
            senderName: document.getElementById('senderName'),
            occasion: document.getElementById('occasion'),
            eventDate: document.getElementById('eventDate'),
            cardPreview: document.getElementById('cardPreview'),
            cardTitle: document.getElementById('cardTitle'),
            cardSubtitle: document.getElementById('cardSubtitle'),
            footerMessage: document.getElementById('footerMessage'),
            senderDisplay: document.getElementById('senderDisplay'),
            simpleCanvas: document.getElementById('simpleCanvas'),
            sharingSection: document.getElementById('sharingSection'),
            shareableLink: document.getElementById('shareableLink'),
            templateGrid: document.getElementById('templateGrid'),
            templateGridCompact: document.getElementById('templateGridCompact'),
            templateSectionRight: document.getElementById('templateSectionRight'),
            advancedInfo: document.getElementById('advancedInfo'),
            advancedTemplates: document.getElementById('advancedTemplates')
        };

        let isToastCollapsed = false;

        function toggleSessionToast() {
            isToastCollapsed = !isToastCollapsed;
            elements.sessionToast.classList.toggle('collapsed', isToastCollapsed);
        }

        function switchMode(mode) {
            currentMode = mode;
            document.body.className = mode + '-mode';

            document.getElementById('simpleMode').classList.toggle('active', mode === 'simple');
            document.getElementById('advancedMode').classList.toggle('active', mode === 'advanced');

            if (mode === 'simple') {
                elements.advancedInfo.style.display = 'none';
                elements.advancedTemplates.style.display = 'none';
                elements.templateSectionRight.style.display = 'none';
                elements.simpleCanvas.style.display = 'block';
                elements.cardPreview.style.display = 'none';
                elements.sharingSection.style.display = 'none';
            } else {
                elements.advancedInfo.style.display = 'block';
                elements.advancedTemplates.style.display = 'block';
                elements.templateSectionRight.style.display = 'block';
                elements.simpleCanvas.style.display = 'none';
                elements.cardPreview.style.display = 'block';
                elements.sharingSection.style.display = 'block';
                updateCardPreview();
            }

            saveSession();
        }

        function selectTemplate(templateName) {
            currentTemplate = templateName;

            document.querySelectorAll('.template-card, .template-card-compact').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelectorAll(`[data-template="${templateName}"]`).forEach(card => {
                card.classList.add('active');
            });

            const template = greetingTemplates[templateName];
            elements.gradientColor1.value = template.colors.primary;
            elements.gradientColor2.value = template.colors.secondary;
            elements.animation.value = template.defaultAnimation;

            updateCardPreview();
            updateCanvas();
            saveSession();
        }

        function updateCardPreview() {
            if (currentMode !== 'advanced') return;

            const template = greetingTemplates[currentTemplate];
            const recipientName = elements.recipientName.value || 'Someone Special';
            const senderName = elements.senderName.value || 'Your Friend';
            const occasion = elements.occasion.value;

            elements.cardTitle.textContent = occasion ?
                `🎉 Happy ${occasion}! 🎂` : template.title;

            elements.cardSubtitle.textContent =
                `Dear ${recipientName}, ${template.subtitle.toLowerCase()}`;

            elements.footerMessage.textContent = template.footer;
            elements.senderDisplay.textContent = senderName;

            const headerGradient = `linear-gradient(135deg, ${template.colors.primary}, ${template.colors.secondary})`;
            elements.cardPreview.querySelector('.card-header').style.background = headerGradient;
        }

        function generateSessionId() {
            return 'BWC-' + Math.random().toString(36).substring(2, 8).toUpperCase() +
                   '-' + Date.now().toString(36).toUpperCase();
        }

        function initializeSession() {
            const existingSession = localStorage.getItem('birthdayWishSession');
            const now = new Date().getTime();

            if (existingSession) {
                const session = JSON.parse(existingSession);
                const sessionAge = now - session.startTime;
                const twelveHours = 12 * 60 * 60 * 1000;

                if (sessionAge < twelveHours) {
                    userSession = session;
                    loadSessionData();
                } else {
                    createNewSession();
                }
            } else {
                createNewSession();
            }

            updateSessionDisplay();
            startSessionTimer();
        }

        function createNewSession() {
            const now = new Date().getTime();
            userSession = {
                id: generateSessionId(),
                startTime: now,
                endTime: now + (12 * 60 * 60 * 1000),
                data: {
                    wishText: '',
                    animation: 'none',
                    fontSize: 60,
                    textColor: '#ffffff',
                    strokeColor: '#000000',
                    strokeWidth: 2,
                    fontFamily: 'Arial, sans-serif',
                    textPosition: 'center',
                    backgroundType: 'gradient',
                    gradientColor1: '#667eea',
                    gradientColor2: '#764ba2',
                    gradientDirection: 'linear-gradient(135deg,',
                    climateEffect: 'none',
                    particleIntensity: 5,
                    photoOpacity: 80
                }
            };
            saveSession();
        }

        function saveSession() {
            userSession.data = {
                wishText: elements.wishText.value,
                animation: elements.animation.value,
                fontSize: elements.fontSize.value,
                textColor: elements.textColor.value,
                strokeColor: elements.strokeColor.value,
                strokeWidth: elements.strokeWidth.value,
                fontFamily: elements.fontFamily.value,
                textPosition: elements.textPosition.value,
                backgroundType: elements.backgroundType.value,
                gradientColor1: elements.gradientColor1.value,
                gradientColor2: elements.gradientColor2.value,
                gradientDirection: elements.gradientDirection.value,
                climateEffect: elements.climateEffect.value,
                particleIntensity: elements.particleIntensity.value,
                photoOpacity: elements.photoOpacity.value
            };
            localStorage.setItem('birthdayWishSession', JSON.stringify(userSession));
        }

        function loadSessionData() {
            const data = userSession.data;
            elements.wishText.value = data.wishText || '';
            elements.animation.value = data.animation || 'none';
            elements.fontSize.value = data.fontSize || 60;
            elements.textColor.value = data.textColor || '#ffffff';
            elements.strokeColor.value = data.strokeColor || '#000000';
            elements.strokeWidth.value = data.strokeWidth || 2;
            elements.fontFamily.value = data.fontFamily || 'Arial, sans-serif';
            elements.textPosition.value = data.textPosition || 'center';
            elements.backgroundType.value = data.backgroundType || 'gradient';
            elements.gradientColor1.value = data.gradientColor1 || '#667eea';
            elements.gradientColor2.value = data.gradientColor2 || '#764ba2';
            elements.gradientDirection.value = data.gradientDirection || 'linear-gradient(135deg,';
            elements.climateEffect.value = data.climateEffect || 'none';
            elements.particleIntensity.value = data.particleIntensity || 5;
            elements.photoOpacity.value = data.photoOpacity || 80;

            updateRangeValues();
            updateCharCount();
        }

        function updateSessionDisplay() {
            if (elements.sessionId) elements.sessionId.textContent = userSession.id;
            if (elements.sessionIdToast) elements.sessionIdToast.textContent = userSession.id;
        }

        function startSessionTimer() {
            setInterval(() => {
                const now = new Date().getTime();
                const timeLeft = userSession.endTime - now;

                if (timeLeft <= 0) {
                    resetSession();
                    return;
                }

                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                if (elements.sessionTimer) elements.sessionTimer.textContent = timeString;
                if (elements.sessionTimerToast) elements.sessionTimerToast.textContent = timeString;
            }, 1000);
        }

        function resetSession() {
            localStorage.removeItem('birthdayWishSession');
            createNewSession();
            loadSessionData();
            updateSessionDisplay();
            updateCanvas();
            backgroundImage = null;
            elements.climateOverlay.innerHTML = '';
        }

        const profanityList = [
            'damn', 'hell', 'crap', 'stupid', 'idiot', 'moron', 'dumb', 'hate', 'suck', 'loser',
            'shut up', 'die', 'kill', 'death', 'murder', 'bloody', 'bastard', 'bitch', 'ass',
            'piss', 'shit', 'fuck', 'fucking', 'fucked', 'motherfucker', 'cocksucker',
            'dickhead', 'asshole', 'whore', 'slut', 'retard', 'gay', 'faggot', 'nigger',
            'chink', 'spic', 'kike', 'wetback', 'gook', 'raghead', 'towelhead', 'camel jockey'
        ];

        function containsProfanity(text) {
            const lowerText = text.toLowerCase();
            return profanityList.some(word => {
                const regex = new RegExp(`\\b${word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, 'i');
                return regex.test(lowerText);
            });
        }

        function showWarning() {
            elements.warningMessage.classList.add('show');
            setTimeout(() => {
                elements.warningMessage.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            }, 100);
        }

        function closeWarning() {
            elements.warningMessage.classList.remove('show');
        }

        function validateAndUpdateText() {
            const text = elements.wishText.value;

            if (containsProfanity(text)) {
                showWarning();
                elements.wishText.value = text.slice(0, -1);
                return false;
            }

            closeWarning();
            return true;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');

            const tabMap = {
                'text': 'textTab',
                'media': 'mediaTab',
                'climate': 'climateTab'
            };

            if (tabMap[tabName]) {
                document.getElementById(tabMap[tabName]).classList.add('active');
            }
        }

        function updateCanvas() {
            const activeCanvas = currentMode === 'simple' ? simpleCanvas : canvas;
            const activeCtx = currentMode === 'simple' ? simpleCtx : ctx;

            activeCtx.clearRect(0, 0, activeCanvas.width, activeCanvas.height);

            drawBackground(activeCtx, activeCanvas);
            drawBackgroundImage(activeCtx, activeCanvas);
            drawText(activeCtx, activeCanvas);

            if (currentMode === 'simple') {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBackground(ctx, canvas);
                drawBackgroundImage(ctx, canvas);
                drawText(ctx, canvas);
            }
        }

        function drawBackground(context, canvasEl) {
            const bgType = elements.backgroundType.value;

            if (bgType === 'photo' && backgroundImage) {
                return;
            }

            if (bgType === 'gradient') {
                const direction = elements.gradientDirection.value;
                const color1 = elements.gradientColor1.value;
                const color2 = elements.gradientColor2.value;

                let gradient;
                if (direction.includes('radial')) {
                    gradient = context.createRadialGradient(canvasEl.width/2, canvasEl.height/2, 0, canvasEl.width/2, canvasEl.height/2, Math.max(canvasEl.width, canvasEl.height)/2);
                } else if (direction.includes('90deg')) {
                    gradient = context.createLinearGradient(0, 0, canvasEl.width, 0);
                } else if (direction.includes('0deg')) {
                    gradient = context.createLinearGradient(0, 0, 0, canvasEl.height);
                } else {
                    gradient = context.createLinearGradient(0, 0, canvasEl.width, canvasEl.height);
                }

                gradient.addColorStop(0, color1);
                gradient.addColorStop(1, color2);
                context.fillStyle = gradient;
            } else {
                context.fillStyle = elements.gradientColor1.value;
            }

            context.fillRect(0, 0, canvasEl.width, canvasEl.height);
        }

        function drawBackgroundImage(context, canvasEl) {
            if (backgroundImage) {
                const opacity = elements.photoOpacity.value / 100;
                context.globalAlpha = opacity;

                const aspectRatio = backgroundImage.width / backgroundImage.height;
                const canvasRatio = canvasEl.width / canvasEl.height;

                let drawWidth, drawHeight, offsetX, offsetY;

                if (aspectRatio > canvasRatio) {
                    drawHeight = canvasEl.height;
                    drawWidth = drawHeight * aspectRatio;
                    offsetX = (canvasEl.width - drawWidth) / 2;
                    offsetY = 0;
                } else {
                    drawWidth = canvasEl.width;
                    drawHeight = drawWidth / aspectRatio;
                    offsetX = 0;
                    offsetY = (canvasEl.height - drawHeight) / 2;
                }

                context.drawImage(backgroundImage, offsetX, offsetY, drawWidth, drawHeight);
                context.globalAlpha = 1;
            }
        }

        function drawText(context, canvasEl) {
            const text = elements.wishText.value || 'Happy Birthday! 🎉';
            const fontSize = elements.fontSize.value;
            const fontFamily = elements.fontFamily.value;
            const textColor = elements.textColor.value;
            const strokeColor = elements.strokeColor.value;
            const strokeWidth = elements.strokeWidth.value;
            const position = elements.textPosition.value;

            context.font = `bold ${fontSize}px ${fontFamily}`;
            context.textAlign = 'center';
            context.textBaseline = 'middle';

            let x = canvasEl.width / 2;
            let y = canvasEl.height / 2;

            switch (position) {
                case 'top':
                    y = fontSize;
                    break;
                case 'bottom':
                    y = canvasEl.height - fontSize / 2;
                    break;
                case 'left':
                    x = fontSize;
                    context.textAlign = 'left';
                    break;
                case 'right':
                    x = canvasEl.width - fontSize;
                    context.textAlign = 'right';
                    break;
            }

            if (strokeWidth > 0) {
                context.strokeStyle = strokeColor;
                context.lineWidth = strokeWidth;
                context.strokeText(text, x, y);
            }

            context.fillStyle = textColor;
            context.fillText(text, x, y);
        }

        function createParticle(type) {
            const particle = {
                x: Math.random() * canvas.width,
                y: -20,
                speed: Math.random() * 3 + 1,
                size: Math.random() * 10 + 5,
                type: type
            };

            return particle;
        }

        function updateParticles() {
            const climateType = elements.climateEffect.value;
            const intensity = elements.particleIntensity.value;

            if (climateType === 'none') {
                elements.climateOverlay.innerHTML = '';
                return;
            }

            if (Math.random() < intensity / 20) {
                const particle = document.createElement('div');
                particle.className = `particle ${climateType === 'snow' ? 'snowflake' :
                                                climateType === 'rain' ? 'raindrop' :
                                                climateType === 'hearts' ? 'heart' : 'star'}`;

                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDuration = (Math.random() * 3 + 2) + 's';
                particle.style.animationDelay = Math.random() * 2 + 's';

                if (climateType === 'snow') {
                    particle.textContent = '❄';
                } else if (climateType === 'hearts') {
                    particle.textContent = '💖';
                } else if (climateType === 'stars') {
                    particle.textContent = '⭐';
                }

                elements.climateOverlay.appendChild(particle);

                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 5000);
            }
        }

        function animate() {
            updateCanvas();
            updateParticles();
            animationId = requestAnimationFrame(animate);
        }

        function downloadImage(format) {
            const activeCanvas = currentMode === 'simple' ? simpleCanvas : canvas;
            const link = document.createElement('a');
            const filename = `birthday-wish.${format}`;

            if (format === 'jpeg') {
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = activeCanvas.width;
                tempCanvas.height = activeCanvas.height;

                tempCtx.fillStyle = 'white';
                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                tempCtx.drawImage(activeCanvas, 0, 0);

                link.href = tempCanvas.toDataURL('image/jpeg', 0.9);
            } else {
                link.href = activeCanvas.toDataURL('image/png');
            }

            link.download = filename;
            link.click();
        }

        function generateShareableLink() {
            const cardData = {
                recipientName: elements.recipientName.value,
                senderName: elements.senderName.value,
                occasion: elements.occasion.value,
                message: elements.wishText.value,
                template: currentTemplate,
                mode: currentMode
            };

            const encodedData = btoa(JSON.stringify(cardData));
            const baseUrl = window.location.origin + window.location.pathname;
            return `${baseUrl}?card=${encodedData}`;
        }

        function copyToClipboard() {
            const shareUrl = generateShareableLink();
            elements.shareableLink.textContent = shareUrl;

            navigator.clipboard.writeText(shareUrl).then(() => {
                elements.shareableLink.textContent = '✅ Link copied to clipboard!';
                setTimeout(() => {
                    elements.shareableLink.textContent = shareUrl;
                }, 2000);
            });
        }

        function shareViaEmail() {
            const shareUrl = generateShareableLink();
            const recipientName = elements.recipientName.value || 'Someone Special';
            const subject = `🎉 Happy Birthday ${recipientName}! 🎂`;
            const body = `I created a special birthday card for you! Click here to view it: ${shareUrl}`;

            window.open(`mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`);
        }

        function shareViaWhatsApp() {
            const shareUrl = generateShareableLink();
            const recipientName = elements.recipientName.value || 'Someone Special';
            const message = `🎉 Happy Birthday ${recipientName}! 🎂\nI made you a special birthday card: ${shareUrl}`;

            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`);
        }

        function shareViaFacebook() {
            const shareUrl = generateShareableLink();
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`);
        }

        function shareViaTwitter() {
            const shareUrl = generateShareableLink();
            const recipientName = elements.recipientName.value || 'Someone Special';
            const message = `🎉 Happy Birthday ${recipientName}! 🎂 I created a special birthday card! ${shareUrl}`;

            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}`);
        }

        function downloadFullCard() {
            if (currentMode === 'advanced') {
                downloadImage('png');
            } else {
                downloadImage('png');
            }
        }

        function randomizeColors() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7', '#fd79a8', '#00b894', '#fdcb6e', '#ff7675', '#74b9ff', '#a29bfe', '#fd79a8', '#e17055'];

            elements.textColor.value = colors[Math.floor(Math.random() * colors.length)];
            elements.gradientColor1.value = colors[Math.floor(Math.random() * colors.length)];
            elements.gradientColor2.value = colors[Math.floor(Math.random() * colors.length)];
            elements.strokeColor.value = colors[Math.floor(Math.random() * colors.length)];

            updateCanvas();
        }

        function randomizeAnimation() {
            const animations = ['bounce', 'pulse', 'shake', 'glow', 'rainbow', 'rotate', 'fadeIn', 'slideIn'];
            elements.animation.value = animations[Math.floor(Math.random() * animations.length)];
        }

        function printWish() {
            window.print();
        }

        function resetAll() {
            elements.wishText.value = '';
            elements.animation.value = 'none';
            elements.fontSize.value = 60;
            elements.textColor.value = '#ffffff';
            elements.strokeColor.value = '#000000';
            elements.strokeWidth.value = 2;
            elements.fontFamily.value = 'Arial, sans-serif';
            elements.textPosition.value = 'center';
            elements.backgroundType.value = 'gradient';
            elements.gradientColor1.value = '#667eea';
            elements.gradientColor2.value = '#764ba2';
            elements.gradientDirection.value = 'linear-gradient(135deg,';
            elements.climateEffect.value = 'none';
            elements.particleIntensity.value = 5;
            elements.photoOpacity.value = 80;

            backgroundImage = null;
            elements.climateOverlay.innerHTML = '';

            updateRangeValues();
            updateCharCount();
            updateCanvas();
        }

        function updateRangeValues() {
            elements.fontSizeValue.textContent = elements.fontSize.value;
            elements.strokeWidthValue.textContent = elements.strokeWidth.value;
            elements.photoOpacityValue.textContent = elements.photoOpacity.value;
            elements.particleIntensityValue.textContent = elements.particleIntensity.value;
        }

        function updateCharCount() {
            elements.charCount.textContent = elements.wishText.value.length;
        }

        elements.wishText.addEventListener('input', () => {
            if (validateAndUpdateText()) {
                updateCharCount();
                updateCanvas();
                saveSession();
            }
        });

        elements.photoUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        backgroundImage = img;
                        updateCanvas();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        [elements.fontSize, elements.strokeWidth, elements.photoOpacity, elements.particleIntensity].forEach(slider => {
            slider.addEventListener('input', () => {
                updateRangeValues();
                updateCanvas();
                saveSession();
            });
        });

        [elements.animation, elements.textColor, elements.strokeColor, elements.fontFamily,
         elements.textPosition, elements.backgroundType, elements.gradientColor1,
         elements.gradientColor2, elements.gradientDirection, elements.climateEffect].forEach(control => {
            control.addEventListener('change', () => {
                updateCanvas();
                saveSession();
            });
        });

        [elements.recipientName, elements.senderName, elements.occasion, elements.eventDate].forEach(input => {
            input.addEventListener('input', () => {
                updateCardPreview();
                saveSession();
            });
        });

        elements.templateGrid.addEventListener('click', (e) => {
            const templateCard = e.target.closest('.template-card');
            if (templateCard) {
                const template = templateCard.dataset.template;
                selectTemplate(template);
            }
        });

        elements.templateGridCompact.addEventListener('click', (e) => {
            const templateCard = e.target.closest('.template-card-compact');
            if (templateCard) {
                const template = templateCard.dataset.template;
                selectTemplate(template);
            }
        });

        initializeSession();
        updateRangeValues();
        updateCharCount();
        updateCanvas();
        animate();
    </script>
</body>
</html>